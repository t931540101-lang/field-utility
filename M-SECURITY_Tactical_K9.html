<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-SECURITY æ•´åˆæŸ¥è©¢</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
    // ä½ çš„é›²ç«¯é…ç½®
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        authDomain: "factor-security-d1965.firebaseapp.com",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        storageBucket: "factor-security-d1965.firebasestorage.app",
        messagingSenderId: "864846943143",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // é—œéµï¼šå³æ™‚æŠ“å–é›²ç«¯é»‘åå–®ä¸¦é¡¯ç¤ºåœ¨ã€Œé€²éšã€åˆ†é 
    function syncBlacklist() {
        const listContainer = document.querySelector('#page1 .blacklist-content'); // å°æ‡‰é€²éšé å®¹å™¨
        db.ref('M_SECURITY/blacklist').on('value', (snapshot) => {
            const data = snapshot.val();
            let html = '<h3 style="color:red">ğŸ›‘ ç®¡åˆ¶é»‘åå–® (é›²ç«¯åŒæ­¥)</h3>';
            if (data) {
                Object.values(data).forEach(item => {
                    html += `<div style="padding:15px; background:white; margin-bottom:10px; border-radius:5px; border-left:5px solid red;">
                                <b style="font-size:18px;">${item.name}</b><br>
                                <span style="color:#666;">è»Šç‰Œ/å·¥è™Ÿï¼š${item.plate}</span><br>
                                <span style="color:red; font-weight:bold;">åŸå› ï¼š${item.reason}</span>
                             </div>`;
                });
            } else {
                html += '<p style="color:gray;">ç›®å‰è³‡æ–™åº«ç„¡ç®¡åˆ¶ç´€éŒ„</p>';
            }
            if(listContainer) listContainer.innerHTML = html;
        });
    }

    // æ“´å……åŠŸèƒ½ï¼šä¸€èˆ¬æŸ¥è©¢æ™‚è‹¥é‡åˆ°é»‘åå–®è‡ªå‹•è­¦ç¤º
    function doQuery() {
        const val = document.getElementById('mainIn').value.trim().toUpperCase();
        if(!val) return;
        const res = document.getElementById('res');
        res.style.display = 'block';

        // å…ˆæŸ¥é»‘åå–®è·¯å¾‘
        db.ref('M_SECURITY/blacklist/' + val).once('value', (snap) => {
            const blackData = snap.val();
            if(blackData) {
                res.innerHTML = `<div style="background:#ffebee; border:4px solid red; padding:15px;">
                                    <h2 style="color:red; margin:0;">âš ï¸ è­¦å‘Šï¼šç®¡åˆ¶å°è±¡</h2>
                                    <p>å§“åï¼š${blackData.name}</p>
                                    <p>åŸå› ï¼š${blackData.reason}</p>
                                 </div>`;
            } else {
                res.innerHTML = `<h3>[ æŸ¥è©¢çµæœ ]</h3><p>å·¥è™Ÿï¼š${val}</p><p>ç‹€æ…‹ï¼š<b>æ­£å¸¸é€šè¡Œ</b></p>`;
            }
        });
    }
</script>
    <style>
        :root { --header-grad: linear-gradient(to bottom, #7ba6d9, #4a76a8); --bg: #e6f0fa; --tab-blue: #6089b3; --tab-active: #4a76a8; --btn-grad: linear-gradient(to bottom, #4da1ff, #2188ff); }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* æ¨™é¡Œèˆ‡åˆ†é  */
        .header { background: var(--header-grad); color: white; padding: 18px 0; text-align: center; }
        .header h1 { margin: 0; font-style: italic; font-size: 26px; letter-spacing: 2px; }
        .tabs { display: flex; background: var(--tab-blue); }
        .tab { flex: 1; text-align: center; padding: 14px 0; color: #d1d5db; font-size: 15px; cursor: pointer; border-right: 1px solid rgba(255,255,255,0.1); }
        .tab.active { background: var(--tab-active); color: white; font-weight: bold; }

        /* å…§å®¹å€å¡Šæ§åˆ¶ */
        .container { padding: 15px; }
        .content-page { display: none; }
        .content-page.active { display: block; }

        /* ä¸€èˆ¬æŸ¥è©¢ UI */
        .query-mode { margin: 10px 0; font-size: 16px; font-weight: bold; }
        .badge { background: #007bff; color: white; padding: 2px 10px; border-radius: 4px; font-size: 13px; margin-left: 5px; }
        .input-card { background: white; border: 2px solid #a5c7f2; border-radius: 6px; padding: 12px; margin-bottom: 15px; }
        .input-card label { color: #888; font-size: 13px; display: block; margin-bottom: 5px; }
        textarea { width: 100%; border: none; font-size: 18px; outline: none; resize: none; height: 65px; font-weight: bold; background: transparent; }

        /* æŒ‰éˆ•è¦–è¦º */
        .btn { border: none; border-radius: 8px; color: white; font-size: 22px; font-weight: bold; padding: 16px; width: 100%; margin-bottom: 15px; cursor: pointer; box-shadow: 0 4px #1a6edb; }
        .btn-query { background: var(--btn-grad); }
        .btn-scan { background: linear-gradient(to bottom, #7fb9ff, #50a1ff); }
        .footer-btns { display: flex; gap: 10px; }
        .btn-sub { flex: 1; background: var(--btn-grad); padding: 12px; font-size: 16px; box-shadow: 0 3px #1a6edb; border:none; color:white; border-radius:6px; font-weight:bold; }

        /* çµæœèˆ‡æƒæå€ */
        #reader { width: 100%; display: none; margin-bottom: 15px; border: 2px solid var(--tab-active); }
        #res { margin-top: 15px; padding: 15px; background: white; border-radius: 8px; border-left: 10px solid #28a745; display: none; }

        /* è­¦è¡›è³‡è¨Š */
        .sys-info { text-align: right; margin-top: 40px; color: #888; font-size: 12px; font-family: monospace; }
        .unit-red { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header"><h1>M-SECURITY æ•´åˆæŸ¥è©¢</h1></div>

    <div class="tabs">
        <div class="tab active" onclick="switchPage(0)">ä¸€èˆ¬</div>
        <div class="tab" onclick="switchPage(1)">é€²éš</div>
        <div class="tab" onclick="switchPage(2)">æ‡‰ç”¨</div>
        <div class="tab" onclick="switchPage(3)">é »é“</div>
        <div class="tab" onclick="switchPage(4)">è¨­å®š</div>
    </div>

    <div class="container">
        <div id="page0" class="content-page active">
            <div class="query-mode">æŸ¥è©¢æ¨¡å¼ï¼š<span class="badge">ç·šä¸Š</span></div>
            <div class="input-card">
                <label>è»Šç‰Œ/å·¥è™Ÿ</label>
                <textarea id="mainIn" placeholder="è«‹è¼¸å…¥æ¬²æŸ¥è©¢è³‡æ–™"></textarea>
            </div>
            <div id="reader"></div>
            <button class="btn btn-query" onclick="doQuery()">æŸ¥ è©¢</button>
            <button class="btn btn-scan" id="scanBtn" onclick="toggleScan()">æ¢ ç¢¼ æƒ æ</button>
            <div class="footer-btns">
                <button class="btn-sub" onclick="document.getElementById('mainIn').value=''">æ¸… é™¤</button>
                <button class="btn-sub">è³‡æ–™åŒæ­¥</button>
            </div>
            <div id="res"></div>
        </div>

        <div id="page1" class="content-page">
            <h3 style="color:var(--tab-active)">ğŸ›‘ ç®¡åˆ¶é»‘åå–®</h3>
            <div style="background:white; padding:15px; border-radius:6px;">
                <p style="color:red; font-weight:bold;">è­¦å ±ï¼šä»¥ä¸‹å°è±¡ç¦æ­¢å…¥å» </p>
                <hr>
                <p>â— ABC-1234 (é›¢è·ä¸æ­¸é‚„è­‰ä»¶)</p>
                <p>â— K9-5566 (ç•°å¸¸é »ç¹å‡ºå…¥)</p>
            </div>
        </div>

        <div id="page2" class="content-page">
            <h3 style="color:var(--tab-active)">ğŸ› ï¸ å‹¤å‹™å·¥å…·ç®±</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn-sub" style="height:80px">ğŸš¨ ç·Šæ€¥é€šå ±</button>
                <button class="btn-sub" style="height:80px">ğŸ“‹ å‹¤å‹™æ—¥èªŒ</button>
                <button class="btn-sub" style="height:80px">ğŸ“ ä½ç½®å›å ±</button>
                <button class="btn-sub" style="height:80px">ğŸ“ è¯çµ¡åˆ†æ©Ÿ</button>
            </div>
        </div>

        <div id="page3" class="content-page">
            <h3 style="color:var(--tab-active)">ğŸ“¡ å‹¤å‹™é€šè¨Šé »é“</h3>
            <div style="background:white; padding:15px; border-radius:6px; height:200px; color:#999; text-align:center; padding-top:50px;">
                é€šè¨ŠåŠ å¯†ä¸­...<br>ç›®å‰å°šç„¡æ–°è¨Šæ¯
            </div>
        </div>

        <div id="page4" class="content-page">
            <h3 style="color:var(--tab-active)">âš™ï¸ ç³»çµ±è¨­å®š</h3>
            <div style="background:white; padding:15px; border-radius:6px;">
                <p>è³‡æ–™åº«è·¯å¾‘ï¼šK9-CLOUD-RTDB</p>
                <p>ç›¸æ©Ÿæ¬Šé™ï¼šå·²é–‹å•Ÿ</p>
                <p>ç•¶å‰ç‰ˆæœ¬ï¼šV6.0.240224</p>
            </div>
        </div>

        <div class="sys-info">
            20260224_0810<br>
            <span class="unit-red">K9-UNIT-ACTIVE</span>
        </div>
    </div>

<script>
    // ä¿®æ­£åˆ†é åˆ‡æ›é‚è¼¯
    function switchPage(index) {
        // éš±è—æ‰€æœ‰é é¢
        document.querySelectorAll('.content-page').forEach(p => p.classList.remove('active'));
        // å–æ¶ˆæ‰€æœ‰ Tab æ¿€æ´»ç‹€æ…‹
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        
        // é¡¯ç¤ºç›®æ¨™é é¢èˆ‡æ¿€æ´» Tab
        document.getElementById('page' + index).classList.add('active');
        document.querySelectorAll('.tab')[index].classList.add('active');
        
        // åˆ‡æ›é é¢æ™‚åœæ­¢æƒæå™¨é¿å…å¡é “
        if(index !== 0) stopScan();
    }

    // æƒæå™¨åŠŸèƒ½
    let scn = null;
    function toggleScan() {
        const r = document.getElementById('reader');
        if (scn) { stopScan(); } else {
            r.style.display = 'block';
            scn = new Html5Qrcode("reader");
            scn.start({ facingMode: "environment" }, { fps: 10, qrbox: 200 }, (txt) => {
                document.getElementById('mainIn').value = txt;
                stopScan();
                doQuery();
            }).catch(e => console.log(e));
            document.getElementById('scanBtn').innerText = "é—œ é–‰ æƒ æ";
        }
    }
    function stopScan() {
        if(scn) { scn.stop().then(() => { scn = null; document.getElementById('reader').style.display = 'none'; document.getElementById('scanBtn').innerText = "æ¢ ç¢¼ æƒ æ"; }); }
    }

    function doQuery() {
        const v = document.getElementById('mainIn').value;
        const res = document.getElementById('res');
        res.style.display = 'block';
        res.innerHTML = `<h3>æŸ¥è©¢çµæœ</h3><p>å°è±¡ï¼š${v}</p><p>ç‹€æ…‹ï¼š<b>å» å€å‡†å…¥ OK</b></p>`;
    }
</script>
</body>
</html>
