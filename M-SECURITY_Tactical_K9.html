<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-POLICE | K9 整合終端</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --police-blue: #3b82f6; --neon-green: #39ff14; --bg-dark: #f0f2f5; }
        body { font-family: -apple-system, "Microsoft JhengHei", sans-serif; background: var(--bg-dark); margin: 0; padding: 0; }
        
        /* 頂部藍色導覽列 */
        .nav-header { background: linear-gradient(to bottom, #7ba6d9, #4a76a8); color: white; padding: 10px 0; text-align: center; }
        .nav-tabs { display: flex; background: #6089b3; border-bottom: 2px solid #4a76a8; }
        .tab { flex: 1; text-align: center; padding: 10px 0; font-size: 14px; color: #d1d5db; cursor: pointer; }
        .tab.active { background: #4a76a8; color: white; font-weight: bold; }

        .container { padding: 15px; }
        .search-box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        
        /* 查詢模式切換 */
        .mode-row { margin-bottom: 15px; font-size: 14px; }
        .badge-blue { background: #007bff; color: white; padding: 2px 8px; border-radius: 4px; }

        textarea { width: 100%; border: 2px solid #ddd; border-radius: 4px; padding: 10px; font-size: 18px; box-sizing: border-box; height: 100px; }
        
        /* 戰術按鈕 */
        .btn-main { background: linear-gradient(to bottom, #4da1ff, #2188ff); color: white; border: none; width: 100%; padding: 15px; border-radius: 8px; font-size: 20px; font-weight: bold; margin-top: 10px; box-shadow: 0 4px #1a6edb; }
        .btn-main:active { margin-top: 14px; box-shadow: 0 0px; }
        
        .btn-scan { background: linear-gradient(to bottom, #7fb9ff, #50a1ff); color: white; border: none; width: 100%; padding: 15px; border-radius: 8px; font-size: 20px; font-weight: bold; margin-top: 15px; }
        
        .footer-btns { display: flex; gap: 10px; margin-top: 15px; }
        .btn-sub { flex: 1; background: linear-gradient(to bottom, #4da1ff, #2188ff); color: white; border: none; padding: 10px; border-radius: 4px; font-weight: bold; }

        /* 相機預覽區 */
        #video-container { display: none; width: 100%; margin-top: 10px; border: 2px solid var(--neon-green); position: relative; }
        video { width: 100%; height: auto; }

        #result-display { margin-top: 20px; display: none; background: #fff; padding: 15px; border-radius: 8px; border-left: 10px solid var(--neon-green); }
    </style>
</head>
<body>

    <div class="nav-header">
        <h2 style="margin:0"><i>M-Police</i> 整合查詢</h2>
    </div>

    <div class="nav-tabs">
        <div class="tab active">一般</div>
        <div class="tab">進階</div>
        <div class="tab">應用</div>
        <div class="tab">頻道</div>
        <div class="tab">設定</div>
    </div>

    <div class="container">
        <div class="search-box">
            <div class="mode-row">查詢模式：<span class="badge-blue">線上</span></div>
            <div style="color:#888; font-size:12px; margin-bottom:5px;">車牌/工號</div>
            <textarea id="queryInput" placeholder="請輸入欲查詢資料"></textarea>
            
            <button class="btn-main" onclick="startQuery()">查 詢</button>
            <button class="btn-scan" onclick="toggleCamera()">條 碼 掃 描</button>
            
            <div id="video-container">
                <video id="video" autoplay playsinline></video>
                <div style="position:absolute; bottom:5px; width:100%; text-align:center;">
                    <button onclick="closeCamera()" style="background:red; color:white; border:none; padding:5px 10px;">關閉相機</button>
                </div>
            </div>

            <div class="footer-btns">
                <button class="btn-sub" onclick="document.getElementById('queryInput').value=''">清 除</button>
                <button class="btn-sub">資料同步</button>
            </div>
        </div>

        <div id="result-display">
            </div>

        <div style="text-align:right; margin-top:20px; color:#888; font-size:12px;">
            20260224_0810<br>
            <span style="color:red">K9-UNIT-ACTIVE</span>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
            databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
            projectId: "factor-security-d1965",
            appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let stream = null;

        // 相機功能連動
        async function toggleCamera() {
            const container = document.getElementById('video-container');
            const video = document.getElementById('video');
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = stream;
                container.style.display = 'block';
            } catch (err) {
                alert("無法啟動相機：" + err);
            }
        }

        function closeCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                document.getElementById('video-container').style.display = 'none';
            }
        }

        function startQuery() {
            const val = document.getElementById('queryInput').value.trim().toUpperCase();
            const res = document.getElementById('result-display');
            if(!val) return;

            // 模擬查詢雲端資料
            db.ref('employee_list/' + val).once('value', (s) => {
                const data = s.val();
                res.style.display = 'block';
                if(data) {
                    res.innerHTML = `<h3>身份確認</h3><p>姓名：${data.name}</p><p>單位：${data.dept}</p><p>工號：${data.id}</p>`;
                } else {
                    res.innerHTML = `<h3 style="color:red">查無資料</h3><p>該車牌/工號未登錄於雲端資料庫。</p>`;
                }
            });
        }
    </script>
</body>
</html>
