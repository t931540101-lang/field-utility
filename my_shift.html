<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å€‹äººæ’ç­è¡¨ | ç¨ç«‹å­˜æª”ç‰ˆ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --top-bg: #000; --calendar-header: #3e5c4a; --date-bg: #fcf9ee; --text-color: #333; --weekend-color: #d32f2f; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #e0ddd5; margin: 0; display: flex; flex-direction: column; height: 100vh; color: var(--text-color); }
        
        /* é ‚éƒ¨è³‡è¨Šæ¬„ */
        .info-bar { background: var(--top-bg); color: white; padding: 10px 15px; display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; }
        
        /* æœˆä»½åˆ‡æ›æ¬„ */
        .month-header { background: var(--calendar-header); color: white; display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; font-size: 18px; }
        
        /* æœˆæ›†ç¶²æ ¼ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); background: #ccc; gap: 1px; flex: 1; }
        .day-label { background: #dfd9c7; padding: 5px 0; text-align: center; font-size: 12px; font-weight: bold; }
        .date-cell { background: var(--date-bg); position: relative; display: flex; flex-direction: column; align-items: flex-start; padding: 5px; min-height: 60px; cursor: pointer; }
        .date-cell b { font-size: 14px; }
        .date-cell.sun b, .date-cell.sat b { color: var(--weekend-color); }
        
        /* ç­åˆ¥é¡¯ç¤ºæ–‡å­— */
        .shift-text { width: 100%; text-align: center; margin-top: 10px; font-weight: bold; font-size: 13px; }
        .val-æ—¥ { color: #1565c0; }
        .val-å¤œ { color: #7b1fa2; }
        .val-ä¼‘, .val-ä¾‹, .val-âŒ { color: var(--weekend-color); }

        /* åº•éƒ¨é¸å–® */
        .bottom-tools { background: #fff; padding: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        select, .btn-erase { padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; text-align: center; }
        .btn-erase { background: #fff; cursor: pointer; border: 1px solid #ddd; }
        .btn-erase.active { border: 2px solid var(--primary); background: #fff0f0; }
    </style>
</head>
<body>

<div class="info-bar">
    <span>å§“åï¼šå°é»‘ ğŸ–‹ï¸</span>
    <span>IDï¼šD01762 ğŸ–‹ï¸</span>
</div>

<div class="month-header">
    <span>â—€</span>
    <span>2026å¹´ 2æœˆ</span>
    <span>â–¶</span>
</div>

<div class="calendar-grid">
    <div class="day-label" style="color:var(--weekend-color)">æ—¥</div>
    <div class="day-label">ä¸€</div><div class="day-label">äºŒ</div><div class="day-label">ä¸‰</div>
    <div class="day-label">å››</div><div class="day-label">äº”</div>
    <div class="day-label" style="color:var(--weekend-color)">å…­</div>
    
    <div id="calendar-body" style="display: contents;"></div>
</div>

<div class="bottom-tools">
    <select id="factorySelect">
        <option value="å» å€">ğŸ¢ å» å€</option>
    </select>
    <select id="shiftSelect">
        <option value="">ğŸ“ ç­åˆ¥</option>
        <option value="æ—¥B">æ—¥Bç­</option>
        <option value="æ—¥ç­">æ—¥ç­</option>
        <option value="å¤œB">å¤œBç­</option>
        <option value="å¤œE">å¤œEç­</option>
        <option value="ä¼‘å‡">ä¼‘å‡</option>
        <option value="ç‰¹ä¼‘">ç‰¹ä¼‘</option>
        <option value="ä¾‹å‡">ä¾‹å‡</option>
        <option value="âŒ">ä¸è¡ŒâŒ</option>
    </select>
    <button id="eraseBtn" class="btn-erase" onclick="toggleErase()">æ©¡çš®æ“¦</button>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        authDomain: "factor-security-d1965.firebaseapp.com",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        storageBucket: "factor-security-d1965.firebasestorage.app",
        messagingSenderId: "864846943143",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const myName = "å°é»‘å“¥"; // éœ€å°æ‡‰ç¸½è¡¨ä¸Šçš„å§“å
    let eraseMode = false;

    // 1. åˆå§‹åŒ–æœˆæ›†
    const body = document.getElementById('calendar-body');
    for (let d = 1; d <= 28; d++) {
        const date = new Date(2026, 1, d);
        const day = date.getDay(); // 0 æ˜¯é€±æ—¥
        const cell = document.createElement('div');
        cell.className = `date-cell ${day === 0 ? 'sun' : (day === 6 ? 'sat' : '')}`;
        cell.innerHTML = `<b>${d}</b><div class="shift-text" id="val_${d}"></div>`;
        cell.onclick = () => handleCellClick(d);
        body.appendChild(cell);
    }

    // 2. è™•ç†é»æ“Š (å¡«å…¥ç­åˆ¥æˆ–æ“¦é™¤)
    function handleCellClick(d) {
        const path = `guardSchedules/${myName}_${d}`;
        if (eraseMode) {
            db.ref(path).set('');
        } else {
            const val = document.getElementById('shiftSelect').value;
            if (val) db.ref(path).set(val);
        }
    }

    function toggleErase() {
        eraseMode = !eraseMode;
        document.getElementById('eraseBtn').classList.toggle('active', eraseMode);
    }

    // 3. å¯¦æ™‚ç›£è½
    db.ref('guardSchedules').on('value', (s) => {
        const data = s.val() || {};
        for (let d = 1; d <= 28; d++) {
            const val = data[myName + '_' + d] || "";
            const el = document.getElementById(`val_${d}`);
            if (el) {
                el.innerText = val;
                el.className = 'shift-text';
                if (val) el.classList.add('val-' + val.substring(0,1));
            }
        }
    });
</script>
</body>
</html>
