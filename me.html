<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K9 特休戰情室-精準校核版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #e5e1d3; font-family: sans-serif; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #d1d5db; }
        .day-cell { background-color: white; aspect-ratio: 1/1.3; padding: 4px; font-size: 11px; display: flex; flex-direction: column; cursor: pointer; }
        .off-bg { background-color: #fff1f2; }
        .off-text { color: #b91c1c; font-weight: bold; }
        .work-text { color: #065f46; font-weight: bold; }
        .today-border { border: 2px solid #ef4444 !important; }
        .other-month { background-color: #f3f4f6; pointer-events: none; }
    </style>
</head>
<body class="max-w-md mx-auto shadow-lg min-h-screen flex flex-col">

    <div class="bg-black text-white p-3 flex justify-between items-center">
        <div class="flex flex-col">
            <span class="text-[10px] text-gray-400">執行者：柔</span>
            <span class="font-bold text-sm">夥伴：班長小黑哥</span>
        </div>
        <div class="text-right">
            <span class="text-yellow-500 font-bold text-xl"><span id="hr-count">48</span><span class="text-xs ml-1">HR</span></span>
        </div>
    </div>

    <div class="bg-[#4a6741] text-white p-2 flex justify-between items-center shadow-md">
        <button onclick="changeMonth(-1)" class="px-4 py-1 active:opacity-50">◀</button>
        <div class="text-center">
            <span id="month-label" class="font-bold text-lg">2026年 2月</span>
            <div id="target-info" class="text-[10px] bg-black/20 rounded px-2 py-0.5 mt-1">
                目標休假：10天 (含國定6天)
            </div>
        </div>
        <button onclick="changeMonth(1)" class="px-4 py-1 active:opacity-50">▶</button>
    </div>

    <div class="bg-white px-4 py-2 border-b border-gray-200">
        <div class="flex justify-between text-[10px] mb-1 font-bold">
            <span>排班進度：已排 <span id="current-off-count">0</span> 天</span>
            <span id="diff-msg">還差 10 天</span>
        </div>
        <div class="w-full bg-gray-200 h-1.5 rounded-full overflow-hidden">
            <div id="progress-bar" class="bg-green-600 h-full transition-all duration-300" style="width: 0%"></div>
        </div>
    </div>

    <div class="grid grid-cols-7 bg-[#ede9d9] text-[#9a8c73] text-[10px] text-center py-1">
        <div>日</div><div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div>
    </div>
    <div id="calendar" class="calendar-grid border-b border-gray-300"></div>

    <div class="p-4 bg-[#ede9d9] flex-grow">
        <div class="grid grid-cols-3 gap-2 mb-4">
            <button onclick="deduct(1)" class="bg-white border border-gray-300 py-3 rounded shadow-sm text-xs font-bold active:bg-gray-100">-1 HR</button>
            <button onclick="deduct(4)" class="bg-white border border-gray-300 py-3 rounded shadow-sm text-xs font-bold active:bg-gray-100">-4 HR</button>
            <button onclick="deduct(8)" class="bg-white border border-gray-300 py-3 rounded shadow-sm text-xs font-bold active:bg-gray-100">-8 HR</button>
        </div>
        <div class="text-[9px] text-gray-400 italic text-center">
            攻堅計畫：HP 15s SSD 排線細活 (240G 50機槍)
        </div>
    </div>

    <script>
        // 導入照片中的精準數據
        const yearlyData = {
            1: { goal: 7, holiday: 1, total: 8 },
            2: { goal: 4, holiday: 6, total: 10 },
            3: { goal: 7, holiday: 0, total: 7 },
            4: { goal: 6, holiday: 2, total: 8 },
            5: { goal: 7, holiday: 1, total: 8 },
            6: { goal: 6, holiday: 1, total: 7 },
            7: { goal: 7, holiday: 0, total: 7 },
            8: { goal: 7, holiday: 0, total: 7 },
            9: { goal: 6, holiday: 2, total: 8 },
            10: { goal: 7, holiday: 2, total: 9 },
            11: { goal: 6, holiday: 0, total: 6 },
            12: { goal: 7, holiday: 1, total: 8 }
        };

        let totalHr = parseFloat(localStorage.getItem('k9_total_hr')) || 48;
        let viewDate = new Date(2026, 1, 1);
        let schedule = JSON.parse(localStorage.getItem('k9_schedule')) || {};

        function updateUI() {
            document.getElementById('hr-count').innerText = totalHr;
            localStorage.setItem('k9_total_hr', totalHr);
        }

        function deduct(v) { totalHr -= v; updateUI(); }

        function changeMonth(d) { viewDate.setMonth(viewDate.getMonth() + d); render(); }

        function toggleDay(key) {
            schedule[key] = (schedule[key] === 'off') ? 'work' : 'off';
            localStorage.setItem('k9_schedule', JSON.stringify(schedule));
            render();
        }

        function render() {
            const cal = document.getElementById('calendar');
            const year = viewDate.getFullYear();
            const month = viewDate.getMonth();
            const data = yearlyData[month + 1];
            cal.innerHTML = '';

            document.getElementById('month-label').innerText = `${year}年 ${month + 1}月`;
            document.getElementById('target-info').innerText = `目標休假：${data.total}天 (含國定${data.holiday}天)`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            let offCount = 0;

            for (let i = 0; i < firstDay; i++) cal.innerHTML += `<div class="day-cell other-month"></div>`;

            for (let i = 1; i <= daysInMonth; i++) {
                const key = `${year}-${month+1}-${i}`;
                const type = schedule[key] || (new Date(year, month, i).getDay() % 6 === 0 ? 'work' : 'work'); // 預設全部上班
                const isOff = type === 'off';
                if(isOff) offCount++;

                cal.innerHTML += `
                    <div class="day-cell ${isOff?'off-bg':''}" onclick="toggleDay('${key}')">
                        <div class="${isOff?'off-text':'work-text'}">${i}</div>
                        <div class="text-[8px] text-gray-400 mt-auto">${isOff?'休假':'日B班'}</div>
                    </div>`;
            }

            // 更新進度條
            document.getElementById('current-off-count').innerText = offCount;
            const diff = data.total - offCount;
            document.getElementById('diff-msg').innerText = diff > 0 ? `還差 ${diff} 天` : (diff === 0 ? "已達標！" : `超休 ${Math.abs(diff)} 天`);
            document.getElementById('progress-bar').style.width = Math.min((offCount / data.total) * 100, 100) + '%';
        }

        render();
        updateUI();
    </script>
</body>
</html>
