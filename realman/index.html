<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K9 ç¸é†«è­·ç†ç«™ | å…«å¤§æˆ°é§’é›²ç«¯ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; color: #1e293b; padding: 15px; }
        .medical-container { max-width: 600px; margin: 0 auto; }
        .medical-card { background: white; border: 2px solid #1e293b; box-shadow: 6px 6px 0px #cbd5e1; border-radius: 4px; padding: 15px; margin-bottom: 30px; position: relative; }
        .stamp { border: 2.5px solid #ef4444; color: #ef4444; transform: rotate(-12deg); font-weight: 900; padding: 2px 8px; border-radius: 4px; display: inline-block; font-size: 12px; position: absolute; right: 15px; top: 10px; }
        .grid-table { display: grid; grid-template-columns: 60px 1fr 60px 1fr; border: 2px solid #1e293b; font-size: 13px; text-align: center; }
        .grid-header { background: #1e293b; color: white; padding: 5px; font-weight: 900; border: 0.5px solid #334155; font-size: 11px; }
        .grid-cell { background: white; padding: 5px; font-weight: 700; border: 1px solid #1e293b; display: flex; align-items: center; justify-content: center; }
        .log-section { border: 2px solid #1e293b; border-top: none; margin-top: -2px; }
        .log-header { background: #f1f5f9; border-bottom: 2px solid #1e293b; display: flex; font-weight: 900; font-size: 11px; }
        .log-row { display: flex; border-bottom: 1px solid #cbd5e1; font-size: 12px; min-height: 45px; }
        .add-btn { background: #1e293b; color: white; width: 100%; padding: 12px; font-weight: 900; font-size: 13px; border-radius: 4px; margin-top: 12px; }
        .add-btn:active { background: #059669; transform: scale(0.98); }
    </style>
</head>
<body>

<div class="medical-container">
    <header class="flex justify-between items-center border-b-4 border-slate-800 pb-2 mb-6">
        <div>
            <h1 class="text-xl font-black text-slate-800 leading-tight">å°ç£ç²¾éŠ³çŠ¬éš»<br>è‡¨åºŠç—…æ­·ç³»çµ±</h1>
            <p class="text-[10px] font-bold text-slate-500 mt-1">ğŸ‘©â€âš•ï¸ è­·ç†å¸«ï¼šå°é»‘å“¥ | V7.0 MOBILE</p>
        </div>
        <div class="stamp">å·²èªè­‰</div>
    </header>

    <div id="k9-list"></div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxm4CDB5i8V2CX6lbCu4gxI2TH-jGKFznI8H01CLlnKEh9Fdr71pfeQr7ai6VcVtAvomw/exec";
    
    // åˆå§‹åŒ–å…«éš»ç‹—ç‹—çš„åŸºç¤è³‡æ–™
    const initialDogs = [
        { id: 1, name: 'å¼µå¸ƒä¸', sex: 'M', age: '3Y+', weight: '43.5', breed: 'é«˜å±±çŠ¬' },
        { id: 2, name: 'å¦å¦', sex: 'F', age: '?', weight: '?', breed: 'ç±³å…‹æ–¯' },
        { id: 3, name: 'ç‹—ç‹—3è™Ÿ', sex: '?', age: '?', weight: '?', breed: '?' },
        { id: 4, name: 'ç‹—ç‹—4è™Ÿ', sex: '?', age: '?', weight: '?', breed: '?' },
        { id: 5, name: 'ç‹—ç‹—5è™Ÿ', sex: '?', age: '?', weight: '?', breed: '?' },
        { id: 6, name: 'ç‹—ç‹—6è™Ÿ', sex: '?', age: '?', weight: '?', breed: '?' },
        { id: 7, name: 'ç‹—ç‹—7è™Ÿ', sex: '?', age: '?', weight: '?', breed: '?' },
        { id: 8, name: 'ç‹—ç‹—8è™Ÿ', sex: '?', age: '?', weight: '?', breed: '?' }
    ];

    // å¾æœ¬åœ°è¼‰å…¥ç´€éŒ„
    let allLogs = JSON.parse(localStorage.getItem('K9_ALL_LOGS') || '{}');

    function renderAll() {
        const container = document.getElementById('k9-list');
        container.innerHTML = initialDogs.map(dog => {
            const logs = allLogs[dog.name] || [];
            return `
                <div class="medical-card">
                    <div class="grid-table">
                        <div class="grid-header">å§“å</div><div class="grid-cell text-blue-600">${dog.name}</div>
                        <div class="grid-header">é«”é‡</div><div class="grid-cell">${dog.weight} KG</div>
                        <div class="grid-header">æ€§åˆ¥</div><div class="grid-cell">${dog.sex}/${dog.age}</div>
                        <div class="grid-header">å“ç¨®</div><div class="grid-cell text-[10px]">${dog.breed}</div>
                    </div>
                    <div class="log-section">
                        <div class="log-header">
                            <div class="w-[30%] p-1.5 text-center border-r-2 border-slate-800">è¨ºç™‚æ™‚é–“</div>
                            <div class="w-[70%] p-1.5 italic">è‡¨åºŠç´€éŒ„ (åŒæ­¥é›²ç«¯)</div>
                        </div>
                        <div id="logs-${dog.name}">
                            ${logs.length === 0 ? '<div class="p-4 text-center text-slate-300 italic text-xs">å°šç„¡ç´€éŒ„</div>' : 
                              logs.map(l => `
                                <div class="log-row">
                                    <div class="w-[30%] p-2 border-r-2 border-slate-800 text-[9px] text-slate-500 flex items-center justify-center font-mono text-center">${l.time}</div>
                                    <div class="w-[70%] p-2 italic flex items-center font-medium">${l.note}</div>
                                </div>
                              `).join('')
                            }
                        </div>
                    </div>
                    <button onclick="addEntry('${dog.name}', '${dog.weight}')" class="add-btn">
                        + æ–°å¢è‡¨åºŠç´€éŒ„ (NEW ENTRY)
                    </button>
                </div>
            `;
        }).join('');
    }

    async function addEntry(dogName, weight) {
        const note = prompt(`ç‚º [${dogName}] è¼¸å…¥è‡¨åºŠè¨ºæ–·ç´€éŒ„ï¼š`);
        if (!note) return;

        const now = new Date();
        const timeStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${(now.getMinutes()<10?'0':'')+now.getMinutes()}`;

        // 1. æ›´æ–°æœ¬åœ°æ•¸æ“š
        if (!allLogs[dogName]) allLogs[dogName] = [];
        allLogs[dogName].unshift({ time: timeStr, note: note });
        localStorage.setItem('K9_ALL_LOGS', JSON.stringify(allLogs));
        renderAll();

        // 2. åŒæ­¥é›²ç«¯
        try {
            const query = `type=k9&dogName=${encodeURIComponent(dogName)}&area=${encodeURIComponent(weight + " KG")}&health=é†«ç™‚ç´€éŒ„&note=${encodeURIComponent(note)}`;
            fetch(`${SCRIPT_URL}?${query}`, { mode: 'no-cors' });
            alert(`âœ… ${dogName} çš„ç´€éŒ„å·²åŒæ­¥è‡³æŒ‡æ®éƒ¨ï¼`);
        } catch (e) { console.log("Sync Error"); }
    }

    renderAll();
</script>

</body>
</html>
