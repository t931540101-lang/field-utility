<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Police æ•´åˆæŸ¥è©¢</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --main-blue: #4a76a8; --danger-red: #ff4d4f; --success-green: #28a745; }
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 0; color: #333; }
        
        /* æ‰‹æ©Ÿçª„è¢å¹•æ¯”ä¾‹å„ªåŒ– */
        .header { background: var(--main-blue); color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 20px; }
        .tabs { display: flex; background: #fff; border-bottom: 1px solid #ddd; }
        .tab { flex: 1; text-align: center; padding: 12px; font-size: 14px; cursor: pointer; color: #666; }
        .tab.active { color: var(--main-blue); border-bottom: 3px solid var(--main-blue); font-weight: bold; }

        .container { padding: 15px; }
        .card { background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 15px; }
        
        /* è¼¸å…¥å€å¡Š */
        textarea { width: 100%; border: 1px solid #ccc; border-radius: 5px; font-size: 18px; padding: 10px; box-sizing: border-box; resize: none; height: 60px; margin-bottom: 10px; }
        .btn { width: 100%; border: none; border-radius: 5px; padding: 15px; font-size: 18px; font-weight: bold; cursor: pointer; color: white; }
        .btn-blue { background: var(--main-blue); }
        
        /* çµæœé¡¯ç¤º */
        #result { display: none; margin-top: 15px; border-left: 8px solid #ccc; transition: 0.3s; }
        .res-title { font-weight: bold; font-size: 18px; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div class="header">M-Police æˆ°è¡“çµ‚ç«¯</div>

    <div class="tabs">
        <div class="tab active" onclick="switchPage(0)">ä¸€èˆ¬æŸ¥è©¢</div>
        <div class="tab" onclick="switchPage(1)">ç®¡åˆ¶åå–®</div>
    </div>

    <div class="container">
        <div id="p0" class="page">
            <div class="card">
                <textarea id="valIn" placeholder="è¼¸å…¥å·¥è™Ÿã€è»Šç‰Œæˆ–å§“å"></textarea>
                <button class="btn btn-blue" onclick="doQuery()">åŸ·è¡Œåµæ¸¬</button>
            </div>
            <div id="result" class="card"></div>
        </div>

        <div id="p1" class="page" style="display:none;">
            <div id="blackList" class="container">è¼‰å…¥ä¸­...</div>
        </div>
    </div>

<script>
    // Firebase é…ç½® (èˆ‡ç¸½éƒ¨ä¸€è‡´)
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 1. Local Storage å­˜æª”åŠŸèƒ½å»ºè­°
    function saveToLocal(key, data) {
        localStorage.setItem('M_POLICE_' + key, JSON.stringify(data));
    }

    function getLocal(key) {
        const data = localStorage.getItem('M_POLICE_' + key);
        return data ? JSON.parse(data) : null;
    }

    // 2. é›²ç«¯åŒæ­¥ä¸¦å‚™ä»½è‡³æœ¬åœ°
    function syncData() {
        db.ref('blacklist_data').on('value', (snap) => {
            const data = snap.val();
            if(data) {
                saveToLocal('BLACKLIST', data); // å­˜å…¥ Local Storage
                renderBlacklist(data);
            }
        });
    }

    function renderBlacklist(data) {
        let html = '<h3 style="color:var(--danger-red)">ğŸ›‘ ç¸½éƒ¨ç®¡åˆ¶ä¸­</h3>';
        for(let k in data) {
            html += `<div class="card" style="border-left:5px solid var(--danger-red)">
                        <b>${data[k].name}</b><br><small>åŸå› ï¼š${data[k].reason}</small>
                     </div>`;
        }
        document.getElementById('blackList').innerHTML = html;
    }

    // 3. æŸ¥è©¢é‚è¼¯
    function doQuery() {
        const v = document.getElementById('valIn').value.trim().toUpperCase();
        if(!v) return;
        const res = document.getElementById('result');
        res.style.display = 'block';
        
        // å„ªå…ˆå¾æœ¬åœ°å¿«å–æ‰¾ (ç¢ºä¿è¨Šè™Ÿå·®ä¹Ÿèƒ½ç”¨)
        const localBlack = getLocal('BLACKLIST');
        let found = localBlack ? Object.values(localBlack).find(i => i.name.includes(v)) : null;

        if(found) {
            res.style.borderLeftColor = 'var(--danger-red)';
            res.innerHTML = `<div class="res-title" style="color:var(--danger-red)">ğŸš¨ ç®¡åˆ¶å°è±¡</div>
                             å§“åï¼š${found.name}<br>åŸå› ï¼š${found.reason}`;
        } else {
            // æŸ¥å“¡å·¥è³‡æ–™åº«
            db.ref('employee_list/' + v).once('value', (s) => {
                const e = s.val();
                if(e) {
                    res.style.borderLeftColor = 'var(--success-green)';
                    res.innerHTML = `<div class="res-title" style="color:var(--success-green)">âœ… å“¡å·¥ç¢ºèª</div>
                                     å§“åï¼š${e.name}<br>å–®ä½ï¼š${e.dept}`;
                } else {
                    res.style.borderLeftColor = '#ccc';
                    res.innerHTML = `æŸ¥ç„¡è³‡æ–™ï¼Œè«‹å¼•å°è‡³è¨ªå®¢ç™»è¨˜ã€‚`;
                }
            });
        }
    }

    function switchPage(idx) {
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('p' + idx).style.display = 'block';
        document.querySelectorAll('.tab')[idx].classList.add('active');
        if(idx === 1) syncData();
    }

    // åˆå§‹åŒ–åŒæ­¥
    syncData();
</script>
</body>
</html>
