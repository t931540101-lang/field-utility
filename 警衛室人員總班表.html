<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026å¹´02æœˆè­¦è¡›è¼ªç­ç¸½è¡¨</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #d32f2f; --bg: #f4f7f6; --border: #dee2e6; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .header-box { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 10px; }
        .lock-btn { padding: 8px 18px; border-radius: 25px; border: none; background: #607d8b; color: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .lock-btn.unlocked { background: #43a047; box-shadow: 0 0 10px rgba(67,160,71,0.5); }
        
        /* ç­è¡¨å®¹å™¨ */
        .table-container { width: 100%; overflow-x: auto; background: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        table { border-collapse: collapse; min-width: 1500px; width: 100%; }
        th, td { border: 1px solid var(--border); padding: 6px 2px; text-align: center; font-size: 12px; }
        th { background: #f8f9fa; color: #333; position: sticky; top: 0; z-index: 10; height: 40px; }
        
        /* å›ºå®šæ¬„ä½è¨­å®š */
        .sticky-left { position: sticky; left: 0; background: #fff !important; z-index: 5; border-right: 2px solid #aaa !important; }
        .sticky-left-2 { position: sticky; left: 60px; background: #fff !important; z-index: 5; border-right: 2px solid #ddd !important; }
        
        /* è¼¸å…¥æ¡†ç¾åŒ– */
        input { width: 100%; border: none; text-align: center; font-size: 13px; background: transparent; pointer-events: none; font-weight: bold; height: 30px; }
        .can-edit input { pointer-events: auto; background: #fffde7; }
        
        /* ç‹€æ…‹è‰²å½©ç›´è¦ºåŒ– */
        .val-âŒ { color: #d32f2f; }
        .val-æ—¥ { background: #e3f2fd; color: #1565c0; border-radius: 4px; }
        .val-å¤œ { background: #f3e5f5; color: #7b1fa2; border-radius: 4px; }
        .val-ä¾‹, .val-ä¼‘ { background: #ffebee; color: #c62828; border-radius: 4px; }
        
        /* çµ±è¨ˆæ¬„ä½ */
        .summary-col { background: #f1f8e9 !important; font-weight: bold; color: #2e7d32; }
    </style>
</head>
<body>

<div class="header-box">
    <div style="font-size: 1.2rem; font-weight: bold; color: #2c3e50;">ğŸ“… 2026å¹´02æœˆ è­¦è¡›è¼ªç­ç¸½è¡¨</div>
    <button id="lockBtn" class="lock-btn" onclick="toggleLock()">ğŸ”’ å”¯è®€æ¨¡å¼</button>
</div>

<div class="table-container">
    <table id="rosterTable">
        <thead>
            <tr id="dateHeader">
                <th class="sticky-left" style="width: 60px;">çµ„åˆ¥</th>
                <th class="sticky-left-2" style="width: 80px;">å§“å</th>
                <th class="summary-col">æ—¥</th>
                <th class="summary-col">å¤œ</th>
                <th class="summary-col">ä¼‘</th>
            </tr>
        </thead>
        <tbody id="rosterBody"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        authDomain: "factor-security-d1965.firebaseapp.com",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        storageBucket: "factor-security-d1965.firebasestorage.app",
        messagingSenderId: "864846943143",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let isEditing = false;

    // æ ¹æ“šæ‚¨çš„ç´™æœ¬åå–®
    const staffData = [
        {group: "ç¸½å‹™", name: "ç›§å®¶æ…¶"},
        {group: "ç¸½å‹™", name: "ä½•é´»éš†"},
        {group: "ç¸½å‹™", name: "è”¡æ˜“å€«"},
        {group: "ç¸½å‹™", name: "é‚±é´»éˆ"},
        {group: "ç¸½å‹™", name: "æŸ³æ—­æ´²"},
        {group: "ç¸½å‹™", name: "é­æ¦®å¿—"},
        {group: "ç¸½å‹™", name: "å°é»‘å“¥"}
    ];

    const headerRow = document.getElementById('dateHeader');
    const tbody = document.getElementById('rosterBody');

    // 1. ç”¢ç”Ÿ 1-28 è™Ÿæ¨™é¡Œ
    for (let d = 1; d <= 28; d++) {
        const th = document.createElement('th');
        th.style.width = "40px";
        th.innerText = d;
        headerRow.insertBefore(th, headerRow.lastElementChild.previousElementSibling.previousElementSibling);
    }

    // 2. ç”¢ç”Ÿäººå“¡åˆ—
    staffData.forEach(person => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="sticky-left">${person.group}</td>
            <td class="sticky-left-2"><b>${person.name}</b></td>
        `;
        for (let d = 1; d <= 28; d++) {
            tr.innerHTML += `<td><input id="${person.name}_${d}" onchange="saveShift('${person.name}', ${d}, this.value)" placeholder="-"></td>`;
        }
        // åŠ å…¥çµ±è¨ˆæ¬„æ ¼å­
        tr.innerHTML += `
            <td class="summary-col" id="sum_day_${person.name}">0</td>
            <td class="summary-col" id="sum_night_${person.name}">0</td>
            <td class="summary-col" id="sum_off_${person.name}">0</td>
        `;
        tbody.appendChild(tr);
    });

    // 3. ç›£è½èˆ‡å³æ™‚åŒæ­¥
    db.ref('guardSchedules').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            staffData.forEach(person => {
                let dCount = 0, nCount = 0, oCount = 0;
                for (let d = 1; d <= 28; d++) {
                    const id = `${person.name}_${d}`;
                    const val = data[id] || "";
                    const input = document.getElementById(id);
                    if (input) {
                        input.value = val;
                        // æ¸…é™¤èˆŠæ¨£å¼
                        input.className = "";
                        if(val) input.classList.add('val-' + val.substring(0,1));
                        
                        // çµ±è¨ˆé‚è¼¯
                        if(val.includes("æ—¥")) dCount++;
                        if(val.includes("å¤œ")) nCount++;
                        if(val.includes("ä¾‹") || val.includes("ä¼‘") || val.includes("âŒ")) oCount++;
                    }
                }
                // æ›´æ–°çµ±è¨ˆæ•¸å­—
                document.getElementById(`sum_day_${person.name}`).innerText = dCount;
                document.getElementById(`sum_night_${person.name}`).innerText = nCount;
                document.getElementById(`sum_off_${person.name}`).innerText = oCount;
            });
        }
    });

    function saveShift(name, day, val) {
        db.ref('guardSchedules/' + name + '_' + day).set(val);
    }

    function toggleLock() {
        if (!isEditing) {
            if (prompt("è«‹è¼¸å…¥äººäº‹ç®¡ç†å¯†ç¢¼ï¼š") === "8888") {
                isEditing = true;
                document.body.classList.add('can-edit');
                document.getElementById('lockBtn').innerText = "ğŸ”“ ç·¨è¼¯æ¨¡å¼";
                document.getElementById('lockBtn').classList.add('unlocked');
            }
        } else {
            isEditing = false;
            document.body.classList.remove('can-edit');
            document.getElementById('lockBtn').innerText = "ğŸ”’ å”¯è®€æ¨¡å¼";
            document.getElementById('lockBtn').classList.remove('unlocked');
        }
    }
</script>
</body>
</html>
