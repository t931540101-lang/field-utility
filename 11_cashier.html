<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å» å•†é¤è²» | é›²ç«¯ç‰ˆ</title>
    <link rel="icon" href="IMG_0968.png">
    <link rel="apple-touch-icon" href="IMG_0968.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; padding: 15px; }
        .card { background: white; border: 2px solid #1e293b; border-radius: 12px; box-shadow: 4px 4px 0px #cbd5e1; padding: 20px; margin-bottom: 20px; }
        input, select { border: 2px solid #cbd5e1; border-radius: 8px; padding: 12px; font-size: 18px; font-weight: bold; width: 100%; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 2px solid #1e293b; padding: 12px 8px; text-align: center; font-size: 18px; font-weight: bold; }
        th { background-color: #e2e8f0; }
        .weekend { background-color: #fff9c4; }
        .vendor-summary { background-color: #f0fdf4; color: #166534; font-size: 16px; }
    </style>
</head>
<body>

    <div class="card">
        <h2 class="text-2xl font-black text-center mb-4 border-b-4 border-slate-800 pb-2">å» å•†é¤è²»ç™»è¨˜ (é›²ç«¯)</h2>
        <div class="space-y-4">
            <input type="date" id="entryDate">
            <div class="flex gap-2">
                <select id="vendorSelect" onchange="checkVendor(this.value)">
                    <option value="ä¿Šä¸°">ä¿Šä¸°</option>
                    <option value="ç¥¥ç®">ç¥¥ç®</option>
                    <option value="CUSTOM">â• è‡ªå®šç¾©</option>
                </select>
                <input type="number" id="quantity" value="1" class="w-24 text-center">
            </div>
            <input type="text" id="customVendor" placeholder="è«‹è¼¸å…¥å» å•†åç¨±" class="hidden">
            <button onclick="addEntry()" class="w-full bg-slate-800 text-white py-4 rounded-xl font-bold text-xl shadow-lg active:scale-95 transition-transform">
                å¯«å…¥é›²ç«¯ä¸¦å­˜æª” âœï¸
            </button>
        </div>
    </div>

    <div class="card overflow-hidden" style="padding: 5px;">
        <table id="mainTable">
            <thead>
                <tr>
                    <th style="width: 25%;">æ—¥æœŸ</th>
                    <th>å» å•†</th>
                    <th style="width: 25%;">é‡‘é¡</th>
                    <th style="width: 15%;">ğŸ—‘ï¸</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
            <tfoot id="tableFoot"></tfoot>
        </table>
        <button onclick="clearAll()" class="w-full mt-4 py-2 text-slate-400 text-xs font-bold border border-slate-200 rounded">
            âš ï¸ æœˆåº•å°å®Œå¸³æ¸…ç©ºå…¨éƒ¨ç´€éŒ„
        </button>
    </div>

    <script>
        // Firebase é…ç½® (æ²¿ç”¨å°é»‘å“¥çš„è¨­å®š)
        const firebaseConfig = {
            apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI907S1YdCWor48",
            authDomain: "factor-security-d1965.firebaseapp.com",
            databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
            projectId: "factor-security-d1965",
            storageBucket: "factor-security-d1965.firebasestorage.app",
            messagingSenderId: "864846943143",
            appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        document.getElementById('entryDate').valueAsDate = new Date();

        function checkVendor(val) {
            document.getElementById('customVendor').classList.toggle('hidden', val !== 'CUSTOM');
        }

        function addEntry() {
            const date = document.getElementById('entryDate').value;
            const select = document.getElementById('vendorSelect');
            let vendor = select.value === 'CUSTOM' ? document.getElementById('customVendor').value.trim() : select.value;
            
            if (!vendor) { alert("è«‹è¼¸å…¥å» å•†åç¨±ï¼"); return; }
            const qty = parseInt(document.getElementById('quantity').value) || 0;
            
            if (qty > 0) {
                const newRecord = { date, vendor, qty, price: qty * 65, timestamp: firebase.database.ServerValue.TIMESTAMP };
                db.ref('cashierData').push(newRecord);
                
                // é‡ç½®
                document.getElementById('quantity').value = "1";
                document.getElementById('customVendor').value = "";
                document.getElementById('customVendor').classList.add('hidden');
                select.value = "ä¿Šä¸°";
            }
        }

        // ç›£è½é›²ç«¯è³‡æ–™è®Šå‹•
        db.ref('cashierData').on('value', (snapshot) => {
            const dataObj = snapshot.val();
            const list = dataObj ? Object.keys(dataObj).map(key => ({ id: key, ...dataObj[key] })) : [];
            list.sort((a, b) => new Date(a.date) - new Date(b.date));
            renderTable(list);
        });

        function renderTable(data) {
            const body = document.getElementById('tableBody');
            const foot = document.getElementById('tableFoot');
            let totalSum = 0;
            let vendorTotals = {};
            body.innerHTML = "";

            data.forEach((item) => {
                totalSum += item.price;
                vendorTotals[item.vendor] = (vendorTotals[item.vendor] || 0) + item.price;

                const row = body.insertRow();
                const day = new Date(item.date).getDay();
                if (day === 0 || day === 6) row.className = "weekend";
                
                row.insertCell(0).innerText = item.date.split('-').slice(1).join('/');
                row.insertCell(1).innerText = item.vendor;
                row.insertCell(2).innerText = "$" + item.price;
                const delCell = row.insertCell(3);
                delCell.innerHTML = `<button onclick="deleteItem('${item.id}')" class="text-red-500 text-xl">âŒ</button>`;
            });

            let footHtml = "";
            for (let v in vendorTotals) {
                footHtml += `<tr class="vendor-summary"><td colspan="2">${v}</td><td colspan="2">$${vendorTotals[v]}</td></tr>`;
            }
            footHtml += `<tr class="bg-slate-800 text-white"><td colspan="2">æœ¬æœˆç¸½çµ</td><td colspan="2">$${totalSum}</td></tr>`;
            foot.innerHTML = footHtml;
        }

        function deleteItem(id) {
            if(confirm("ç¢ºå®šåˆªé™¤é€™ç­†ç´€éŒ„ï¼Ÿ")) db.ref(`cashierData/${id}`).remove();
        }

        function clearAll() {
            if(confirm("âš ï¸ æ³¨æ„ï¼é€™æœƒæ¸…ç©ºé›²ç«¯æ‰€æœ‰é¤è²»ç´€éŒ„ï¼Œç¢ºå®šå—ï¼Ÿ")) db.ref('cashierData').remove();
        }
    </script>
</body>
</html>
