<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-SECURITY | æŒ‡æ®å®˜å¾Œå°</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    // åœ¨ script å€å¡ŠåŠ å…¥é»‘åå–®åŒæ­¥åŠŸèƒ½
function syncBlacklist() {
    const listDiv = document.querySelector('#page1 .card-content'); // å°æ‡‰é€²éšé é¢çš„å®¹å™¨
    if (!listDiv) return;

    // å¾é›²ç«¯æŠ“å–æœ€æ–°çš„é»‘åå–®è³‡æ–™
    db.ref('blacklist_data').on('value', (snapshot) => {
        const data = snapshot.val();
        listDiv.innerHTML = '<h3 style="color:red; margin-top:0;">ğŸ›‘ ç®¡åˆ¶é»‘åå–®</h3>';
        
        if (data) {
            Object.values(data).forEach(person => {
                listDiv.innerHTML += `
                    <div style="border-bottom:1px solid #eee; padding:10px 0;">
                        <b style="color:#d32f2f;">[${person.reason}]</b> ${person.name} (${person.id})
                    </div>`;
            });
        } else {
            listDiv.innerHTML += '<p style="color:gray;">ç›®å‰æš«ç„¡ç®¡åˆ¶å°è±¡</p>';
        }
        listDiv.innerHTML += '<p style="font-size:12px; color:gray; margin-top:10px;">è³‡æ–™å·²èˆ‡é›²ç«¯åŒæ­¥æ›´æ–°</p>';
    });
}

// ä¿®æ”¹åˆ†é åˆ‡æ›ï¼Œé»åˆ°ã€Œé€²éšã€æ™‚è§¸ç™¼åŒæ­¥
function switchPage(index) {
    document.querySelectorAll('.content-page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById('page' + index).classList.add('active');
    document.querySelectorAll('.tab')[index].classList.add('active');

    if(index === 1) syncBlacklist(); // é»é€²éšé é¢æ™‚ï¼Œå•Ÿå‹•é›²ç«¯æŠ“å–
    if(index !== 0) stopScan();
}
    <style>
        :root { --admin-blue: #00d2ff; --admin-bg: #0a0b0d; --row-bg: #16181d; }
        body { background: var(--admin-bg); color: var(--admin-blue); font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .header { border-bottom: 2px solid var(--admin-blue); padding-bottom: 10px; margin-bottom: 25px; }
        
        /* éŒ„å…¥å€åŸŸ */
        .input-card { background: var(--row-bg); padding: 20px; border-radius: 8px; display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 10px; align-items: end; }
        .input-group label { display: block; font-size: 11px; margin-bottom: 5px; }
        input { background: #000; border: 1px solid #334; color: #fff; padding: 10px; width: 100%; box-sizing: border-box; }
        .btn-add { background: var(--admin-blue); color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; height: 38px; }

        /* æ¸…å–®å€åŸŸ */
        table { width: 100%; border-collapse: collapse; margin-top: 30px; }
        th { text-align: left; border-bottom: 2px solid #334; padding: 12px; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #222; font-size: 15px; color: #ccc; }
        .btn-del { color: #ff3131; background: none; border: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>M-SECURITY è³‡æ–™åº«ç®¡ç†å¾Œå°</h1>
        <p style="font-size: 12px; color: #666;">DATABASE ID: factor-security-d1965</p>
    </div>

    <div class="input-card">
        <div class="input-group"><label>å“¡å·¥å·¥è™Ÿ</label><input type="text" id="staffID" placeholder="å¦‚: K9001"></div>
        <div class="input-group"><label>å“¡å·¥å§“å</label><input type="text" id="staffName" placeholder="å¦‚: å°é»‘å“¥"></div>
        <div class="input-group"><label>æ‰€å±¬å–®ä½</label><input type="text" id="staffDept" placeholder="å¦‚: è­¦è¡›çµ„"></div>
        <div class="input-group"><label>ç™»è¨˜è»Šç‰Œ</label><input type="text" id="staffPlate" placeholder="å¦‚: ABC-1234"></div>
        <button class="btn-add" onclick="uploadData()">åŒæ­¥è‡³é›²ç«¯</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>å·¥è™Ÿ</th><th>å§“å</th><th>å–®ä½</th><th>è»Šç‰Œ</th><th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody id="dataTable">
            </tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function uploadData() {
        const id = document.getElementById('staffID').value.trim();
        const name = document.getElementById('staffName').value.trim();
        const dept = document.getElementById('staffDept').value.trim();
        const plate = document.getElementById('staffPlate').value.trim().toUpperCase();

        if (!id || !name) return alert("å·¥è™Ÿèˆ‡å§“åç‚ºå¿…å¡«ï¼");

        // æ ¸å¿ƒé‚è¼¯ï¼šç‚ºäº†è®“ M-POLICE æŸ¥é©—ç«¯ã€Œæœå°‹ä¸€å€‹é—œéµå­—ã€å°±èƒ½æŸ¥åˆ°
        // æˆ‘å€‘è¦åœ¨è³‡æ–™åº«è£¡å­˜å…©ä»½ç´¢å¼•ï¼šä¸€ä»½ç”¨å·¥è™Ÿç•¶ Keyï¼Œä¸€ä»½ç”¨è»Šç‰Œç•¶ Key
        const staffObj = { id, name, dept, plate };

        const updates = {};
        updates['/employee_list/' + id] = staffObj;
        if(plate) updates['/employee_list/' + plate] = staffObj;

        db.ref().update(updates).then(() => {
            alert("é›²ç«¯åŒæ­¥æˆåŠŸï¼");
            document.querySelectorAll('input').forEach(i => i.value = '');
        });
    }

    // ç›£è½ä¸¦é¡¯ç¤ºæ¸…å–®
    db.ref('employee_list').on('value', (s) => {
        const data = s.val();
        const table = document.getElementById('dataTable');
        table.innerHTML = '';
        if (data) {
            // æ’é™¤é‡è¤‡é¡¯ç¤ºï¼ˆå› ç‚ºåŒä¸€å€‹äººæœ‰å·¥è™Ÿè·Ÿè»Šç‰Œå…©ç­†è³‡æ–™ï¼‰
            const shown = new Set();
            Object.keys(data).forEach(key => {
                const p = data[key];
                if (!shown.has(p.id)) {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${p.id}</td><td>${p.name}</td><td>${p.dept}</td><td>${p.plate}</td>
                                    <td><button class="btn-del" onclick="deleteData('${p.id}', '${p.plate}')">åˆªé™¤</button></td>`;
                    table.appendChild(tr);
                    shown.add(p.id);
                }
            });
        }
    });

    function deleteData(id, plate) {
        if (confirm("ç¢ºå®šåˆªé™¤æ­¤å“¡å·¥è³‡æ–™ï¼Ÿ")) {
            const updates = {};
            updates['/employee_list/' + id] = null;
            if(plate) updates['/employee_list/' + plate] = null;
            db.ref().update(updates);
        }
    }
</script>
</body>
</html>
