<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-Police V8.9</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: sans-serif; background: #e3f2fd; margin: 0; padding: 0; }
        #auth-screen { background: #cfd8dc; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: fixed; width: 100%; z-index: 999; }
        .login-card { background: #fff; border: 2px solid #3273b5; padding: 20px; border-radius: 12px; width: 85%; max-width: 320px; text-align: center; }
        #main-app { display: none; }
        header { background: #000; color: red; text-align: center; padding: 5px; font-size: 12px; font-weight: bold; }
        .m-header { background: linear-gradient(to bottom, #74b9ff, #3273b5); color: #fff; padding: 15px; text-align: center; font-style: italic; font-weight: 900; font-size: 22px; }
        nav { display: flex; background: #546e7a; color: white; }
        .nav-item { flex: 1; padding: 12px; text-align: center; font-size: 13px; font-weight: bold; cursor: pointer; }
        .nav-item.active { background: rgba(0,0,0,0.3); border-bottom: 3px solid #00f2ff; }
        .container { padding: 15px; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .input-box { background: #fff; border: 2px solid #3273b5; border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .btn { width: 100%; padding: 15px; background: linear-gradient(to bottom, #42a5f5, #1976d2); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 18px; box-shadow: 0 4px #0d47a1; margin-bottom: 10px; }
        .card { background: #fff; border: 2px solid #3273b5; border-radius: 12px; padding: 12px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .vip-card { border-color: #f1c40f; background: #fffdf0; }
        .item-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <div id="auth-screen">
        <header style="position:absolute; top:0; width:100%;">[è­¦æˆ’] éæˆæ¬Šç¦æ­¢é€²å…¥</header>
        <img src="IMG_1092.jpeg" style="width:100px; height:100px; border-radius:50%; border:3px solid #3273b5; background:#fff; margin-bottom:20px; padding:5px; object-fit:cover;">
        <div class="login-card">
            <h2 style="color:#1976d2; margin:0 0 15px 0;">æˆæ¬Šç™»å…¥</h2>
            <input type="text" id="gName" placeholder="å€¼å‹¤äººå“¡å§“å" style="width:100%; padding:10px; margin-bottom:10px; box-sizing:border-box;">
            <input type="password" id="aCode" placeholder="å®‰å…¨æˆæ¬Šç¢¼" style="width:100%; padding:10px; box-sizing:border-box;">
            <button class="btn" style="margin-top:10px;" onclick="checkAuth()">é©—è­‰ç™»å…¥</button>
        </div>
    </div>

    <div id="main-app">
        <header>[é€£ç·šæ­£å¸¸] é›²ç«¯åŒæ­¥ä¸­</header>
        <div class="m-header">M-Police æ•´åˆæŸ¥è©¢</div>
        <nav>
            <div class="nav-item active" onclick="switchTab('general', this)">ä¸€èˆ¬</div>
            <div class="nav-item" onclick="switchTab('vip', this)">é€²éš</div>
            <div class="nav-item" onclick="switchTab('visitor', this)">æ‡‰ç”¨</div>
            <div class="nav-item" onclick="switchTab('handover', this)">é »é“</div>
        </nav>
        <div class="container">
            <div id="general" class="content-section active">
                <div class="input-box"><input type="text" id="qInput" placeholder="è»Šç‰Œ / å·¥è™Ÿ / å§“å" style="width:100%; border:none; font-size:18px; outline:none;"></div>
                <button class="btn" onclick="search()">æŸ¥ è©¢</button>
                <div id="resDiv"></div>
            </div>
            <div id="vip" class="content-section"><div id="vipList">è®€å–ä¸­...</div></div>
            <div id="visitor" class="content-section"><div id="visitorList">è®€å–ä¸­...</div></div>
            <div id="handover" class="content-section"><div id="handoverList">è®€å–ä¸­...</div></div>
        </div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48", databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com", projectId: "factor-security-d1965", appId: "1:864846943143:web:4cfa18cd20d2f712225c82" };
    firebase.initializeApp(firebaseConfig); const db = firebase.database();

    function checkAuth() {
        const n = document.getElementById('gName').value; const c = document.getElementById('aCode').value;
        if(n && c === "8888") { 
            localStorage.setItem('guard', n); 
            document.getElementById('auth-screen').style.display='none'; 
            document.getElementById('main-app').style.display='block';
            startListening(); // ç™»å…¥å¾Œå•Ÿå‹•å³æ™‚ç›£è½
        } else alert("é©—è­‰å¤±æ•—");
    }

    function switchTab(id, el) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    function search() {
        const q = document.getElementById('qInput').value.trim().toUpperCase(); if(!q) return;
        const res = document.getElementById('resDiv'); res.innerHTML = "æœå°‹ä¸­...";
        db.ref('employee_list').once('value', snap => {
            let f = false; snap.forEach(c => { const d = c.val(); if(d.name===q||d.id===q||d.plate===q) {
                res.innerHTML = `<div class="card"><div class="item-row"><b>å§“åï¼š</b><span>${d.name}</span></div><div class="item-row"><b>å–®ä½ï¼š</b><span>${d.reason||'---'}</span></div><div class="item-row"><b>è»Šç‰Œï¼š</b><span>${d.plate||'---'}</span></div></div>`;
                f = true;
            }});
            if(!f) res.innerHTML = "æŸ¥ç„¡è³‡æ–™";
        });
    }

    // ğŸš€ ä¿®å¾©é—œéµï¼šå•Ÿå‹•å³æ™‚ç›£è½
    function startListening() {
        // ç›£è½ VIP
        db.ref('vip_list').on('value', s => {
            const list = document.getElementById('vipList'); list.innerHTML = '';
            s.forEach(c => { const d = c.val(); list.innerHTML += `<div class="card vip-card"><b>ğŸŒŸ ${d.name}</b><br>è»Šè™Ÿï¼š${d.plate}</div>`; });
        });
        // ç›£è½è¨ªå®¢ (åªé¡¯ç¤ºåœ¨å ´)
        db.ref('visitor_logs').limitToLast(10).on('value', s => {
            const list = document.getElementById('visitorList'); list.innerHTML = '';
            s.forEach(c => { const d = c.val(); if(!d.leaveTime) list.innerHTML += `<div class="card" style="border-left:5px solid #27ae60"><b>${d.name}</b><br>å…¥ï¼š${d.timeIn} | å…¬å¸ï¼š${d.company}</div>`; });
        });
        // ç›£è½äº¤æ¥
        db.ref('reactLogs').limitToLast(5).on('value', s => {
            const list = document.getElementById('handoverList'); list.innerHTML = '';
            s.forEach(c => { const d = c.val(); list.innerHTML += `<div class="card" style="border-left:5px solid #2980b9"><small>${d.time}</small><br><b>${d.note}</b></div>`; });
        });
    }
</script>
</body>
</html>
