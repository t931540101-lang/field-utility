<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç­é•·æ’ç­ç¥å™¨ V4.6</title>
    <style>
        :root { --bg-color: #ffffff; --line-color: #e0e0e0; --red-focus: #d32f2f; --theme: #2e5a44; }
        body { margin: 0; font-family: sans-serif; background: #f5f5f5; -webkit-tap-highlight-color: transparent; }
        .calendar-box { max-width: 500px; margin: 0 auto; background: white; min-height: 100vh; padding-bottom: 100px; }
        header { background: var(--theme); color: white; padding: 20px 10px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .header-nav { display: flex; justify-content: space-between; align-items: center; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 1px solid var(--line-color); }
        .weekday { text-align: center; padding: 12px 0; color: #555; font-size: 14px; background: #fafafa; font-weight: bold; border-bottom: 1px solid var(--line-color); }
        .cell { min-height: 140px; border-right: 1px solid var(--line-color); border-bottom: 1px solid var(--line-color); position: relative; padding: 5px 2px; cursor: pointer; display: flex; flex-direction: column; background: #fff; overflow: hidden; }
        .day-num { font-size: 1.3rem; font-weight: bold; }
        
        /* æ ¸å¿ƒä¿®æ­£ï¼šå­—é«”ä¸å‡†æ›è¡Œï¼Œä¸”ç¸®å°é–“è· */
        .memo-text { 
            font-size: 1.1rem; 
            color: var(--theme); 
            font-weight: 900; 
            text-align: center; 
            margin: auto 0;
            white-space: nowrap; /* å¼·åˆ¶ä¸æ›è¡Œ */
            letter-spacing: -1px; /* ç¨å¾®ç¸®å°å­—è·è®“å®ƒæ“ é€²å» */
            width: 100%;
        }
        
        .today { box-shadow: inset 0 0 0 5px var(--red-focus); }
        .done::after { content: ""; position: absolute; top: 30%; left: -5%; width: 110%; height: 5px; background: rgba(211, 47, 47, 0.7); transform: rotate(10deg); pointer-events: none; }

        /* å°ç« å·¥å…·åˆ— */
        .toolbar { position: fixed; bottom: 0; left: 0; width: 100%; background: #eee; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 200; border-top: 1px solid #ccc; }
        .stamp-btn { padding: 12px 8px; background: white; border-radius: 8px; font-weight: bold; border: 2px solid #ccc; font-size: 14px; min-width: 60px; text-align: center; }
        .active-stamp { border-color: var(--theme); background: var(--theme); color: white; }
    </style>
</head>
<body>

<div class="calendar-box">
    <header>
        <div class="header-nav">
            <div onclick="changeMonth(-1)" style="font-size:30px; width:50px; cursor:pointer;">â®</div>
            <div id="calendar-title" style="font-size: 24px; font-weight: bold;">2026å¹´ 3æœˆ</div>
            <div onclick="changeMonth(1)" style="font-size:30px; width:50px; cursor:pointer;">â¯</div>
        </div>
    </header>
    <div class="grid" id="calendarGrid">
        <div class="weekday">æ—¥</div><div class="weekday">ä¸€</div><div class="weekday">äºŒ</div>
        <div class="weekday">ä¸‰</div><div class="weekday">å››</div><div class="weekday">äº”</div><div class="weekday">å…­</div>
    </div>
</div>

<div class="toolbar">
    <div class="stamp-btn" onclick="setStamp('æ—¥Bç­', this)">å°:æ—¥B</div>
    <div class="stamp-btn" onclick="setStamp('å¤œBç­', this)">å°:å¤œB</div>
    <div class="stamp-btn" onclick="setStamp('ä¼‘å‡', this)">å°:ä¼‘</div>
    <div class="stamp-btn" onclick="setStamp('CLEAR', this)" style="color:red;">æ“¦é™¤</div>
    <div class="stamp-btn" onclick="setStamp('CROSS', this)">ğŸ”´/âšª</div>
</div>

<script>
    let currentYear = 2026;
    let currentMonth = 2; 
    let activeStamp = null;

    function setStamp(type, el) {
        if (activeStamp === type) {
            activeStamp = null;
            el.classList.remove('active-stamp');
        } else {
            document.querySelectorAll('.stamp-btn').forEach(b => b.classList.remove('active-stamp'));
            activeStamp = type;
            el.classList.add('active-stamp');
        }
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const weekdays = document.querySelectorAll('.weekday');
        grid.innerHTML = "";
        weekdays.forEach(w => grid.appendChild(w));
        document.getElementById('calendar-title').innerText = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const today = new Date();

        for (let i = 0; i < firstDay; i++) grid.appendChild(Object.assign(document.createElement('div'), {className: 'cell empty-cell'}));

        for (let i = 1; i <= daysInMonth; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            const dateKey = `${currentYear}-${currentMonth + 1}-${i}`;
            if (currentYear === today.getFullYear() && currentMonth === today.getMonth() && i === today.getDate()) cell.classList.add('today');
            if (localStorage.getItem('done-' + dateKey) === "true") cell.classList.add('done');
            const note = localStorage.getItem('note-' + dateKey) || "";
            cell.innerHTML = `<div class="day-num">${i}</div><div class="memo-text">${note}</div>`;
            
            cell.onclick = () => {
                if (!activeStamp) {
                    const newText = prompt("æ‰‹å‹•è¼¸å…¥ï¼š", note);
                    if (newText !== null) save(dateKey, newText, null);
                } else if (activeStamp === 'CROSS') {
                    const isDone = localStorage.getItem('done-' + dateKey) === "true";
                    save(dateKey, null, !isDone);
                } else if (activeStamp === 'CLEAR') {
                    save(dateKey, "", false);
                } else {
                    save(dateKey, activeStamp, null);
                }
            };
            grid.appendChild(cell);
        }
    }

    function save(key, note, done) {
        if (note !== null) localStorage.setItem('note-' + key, note);
        if (done !== null) localStorage.setItem('done-' + key, done);
        renderCalendar();
    }

    function changeMonth(dir) {
        currentMonth += dir;
        if (currentMonth < 0) { currentMonth = 11; currentYear--; }
        else if (currentMonth > 11) { currentMonth = 0; currentYear++; }
        renderCalendar();
    }

    window.onload = renderCalendar;
</script>
</body>
</html>
