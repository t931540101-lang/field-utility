<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K9 æˆ°æƒ…å®¤ V8.2 - é ‚éƒ¨å·¨å­—ç‰ˆ</title>
    <style>
        :root { --paper: #f9f4e8; --ink: #2e5a44; --red: #c0392b; --gold: #b8860b; --line: #dcd3b6; }
        body { margin: 0; font-family: sans-serif; background: #e8e2d0; -webkit-tap-highlight-color: transparent; }
        .calendar-box { max-width: 500px; margin: 0 auto; background: var(--paper); min-height: 100vh; padding-bottom: 120px; }
        
        /* é ‚éƒ¨ï¼šå§“åå·¥è™Ÿå·¨å­—åŒ– */
        .user-info-bar { 
            background: #000000; 
            color: #ffffff; 
            padding: 15px 10px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            border-bottom: 3px solid var(--red);
        }
        .u-left { font-size: 20px; font-weight: 900; width: 40%; }
        .u-center { width: 20%; text-align: center; }
        .u-right { font-size: 20px; font-weight: 900; width: 40%; text-align: right; }
        .hr-big { color: #eab308; font-size: 32px; font-weight: 900; line-height: 1; }
        .hr-unit { color: #eab308; font-size: 10px; display: block; margin-top: -2px; }

        .stat-bar { background: #4a6741; color: white; padding: 8px; display: flex; justify-content: space-around; font-size: 14px; font-weight: bold; }
        
        header { background: var(--ink); color: #fff; padding: 8px; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(7, 1fr); border-top: 1px solid var(--line); }
        .weekday { text-align: center; padding: 6px 0; color: #8e835d; font-size: 13px; background: #f0e9d2; border-bottom: 1px solid var(--line); }
        .cell { min-height: 85px; border-right: 1px solid var(--line); border-bottom: 1px solid var(--line); position: relative; padding: 2px; display: flex; flex-direction: column; background: var(--paper); box-sizing: border-box; }
        .day-num { font-size: 1.1rem; font-weight: bold; color: #4a4a4a; }
        .is-weekend { color: var(--red); }
        
        .memo-text { font-size: 11px; font-weight: 900; text-align: center; margin-top: 4px; line-height: 1.2; white-space: pre-wrap; width: 100%; }
        .color-default { color: var(--ink); }
        .color-holiday { color: var(--red); }
        .color-special { color: var(--gold); }

        .toolbar { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 500px; background: #f2ebd5; border-top: 2px solid var(--line); padding: 10px 0 env(safe-area-inset-bottom); z-index: 200; }
        .control-row { display: flex; justify-content: space-around; padding: 0 10px; gap: 8px; }
        select, .clear-btn { padding: 12px 5px; border-radius: 8px; border: 1.5px solid var(--line); background: #fff; font-size: 15px; font-weight: bold; flex: 1; }
        .clear-btn { color: var(--red); }
    </style>
</head>
<body>
<div class="calendar-box">
    <div class="user-info-bar">
        <div class="u-left" id="uNameDisplay" onclick="editInfo()">å§“åï¼šå°é»‘</div>
        <div class="u-center" onclick="secretReset()">
            <span class="hr-big" id="hr-count">48</span>
            <span class="hr-unit">HR</span>
        </div>
        <div class="u-right" id="uIDDisplay" onclick="editInfo()">å·¥è™Ÿï¼šD01762</div>
    </div>

    <div class="stat-bar">
        <span id="stat-off">æœ¬æœˆå·²ä¼‘ï¼š0 å¤©</span>
        <span id="stat-work">æœ¬æœˆä¸Šç­ï¼š0 å°æ™‚</span>
    </div>

    <header>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0 20px;">
            <div onclick="changeMonth(-1)" style="cursor:pointer; font-size: 20px;">â®</div>
            <div id="calendar-title" style="font-size: 18px; font-weight: bold;">2026å¹´ 3æœˆ</div>
            <div onclick="changeMonth(1)" style="cursor:pointer; font-size: 20px;">â¯</div>
        </div>
    </header>

    <div class="grid" id="calendarGrid"></div>
</div>

<div class="toolbar">
    <div class="control-row">
        <select id="factorySelect" onchange="updateActiveStamp()"><option value="">ğŸ¢ å» å€</option><option value="ä¸€å» ">ä¸€å» </option><option value="äºŒå» ">äºŒå» </option><option value="ä¸‰å» ">ä¸‰å» </option></select>
        <select id="typeSelect" onchange="updateActiveStamp()"><option value="">ğŸ“ é …ç›®</option><option value="æ—¥Bç­">â˜€ï¸æ—¥Bç­</option><option value="å¤œBç­">ğŸŒ™å¤œBç­</option><option value="ä¾‹å‡">ğŸ”´ä¾‹å‡</option><option value="ä¼‘å‡">ğŸŸ¢ä¼‘å‡</option><option value="ç‰¹ä¼‘">â­ç‰¹ä¼‘</option></select>
        <button class="clear-btn" onclick="setClearMode()">æ“¦é™¤</button>
    </div>
</div>

<script>
    let curY = 2026, curM = 2;
    let activeStamp = "", isClearMode = false;
    let totalVacationHr = parseFloat(localStorage.getItem('k9_total_hr')) || 48;

    function updateActiveStamp() { isClearMode = false; activeStamp = "active"; }
    function setClearMode() { isClearMode = true; activeStamp = ""; }

    function editInfo() {
        const n = prompt("è«‹è¼¸å…¥å§“åï¼š", localStorage.getItem('user-name')||"å°é»‘");
        const i = prompt("è«‹è¼¸å…¥å·¥è™Ÿï¼š", localStorage.getItem('user-id')||"D01762");
        if (n) localStorage.setItem('user-name', n);
        if (i) localStorage.setItem('user-id', i);
        renderCalendar();
    }

    function secretReset() {
        let val = prompt("ğŸ”“ ä¿®æ­£å‰©é¤˜ç‰¹ä¼‘ç¸½æ™‚æ•¸ (HR)ï¼š", totalVacationHr);
        if (val !== null) { totalVacationHr = parseFloat(val); saveGlobal(); }
    }

    function saveGlobal() {
        localStorage.setItem('k9_total_hr', totalVacationHr);
        renderCalendar();
    }

    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = ""; 
        ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"].forEach(w => {
            const div = document.createElement('div'); div.className = 'weekday'; div.innerText = w; grid.appendChild(div);
        });

        document.getElementById('calendar-title').innerText = `${curY}å¹´ ${curM + 1}æœˆ`;
        document.getElementById('hr-count').innerText = totalVacationHr;
        document.getElementById('uNameDisplay').innerText = "å§“åï¼š" + (localStorage.getItem('user-name') || "å°é»‘");
        document.getElementById('uIDDisplay').innerText = "å·¥è™Ÿï¼š" + (localStorage.getItem('user-id') || "D01762");

        const firstDay = new Date(curY, curM, 1).getDay();
        const daysInMonth = new Date(curY, curM + 1, 0).getDate();
        
        let workCount = 0; let offCount = 0;

        for (let i = 0; i < firstDay; i++) grid.appendChild(Object.assign(document.createElement('div'), {className: 'cell'}));

        for (let i = 1; i <= daysInMonth; i++) {
            const cell = document.createElement('div');
            const d = new Date(curY, curM, i);
            const dateKey = `${curY}-${curM + 1}-${i}`;
            const note = localStorage.getItem('note-' + dateKey) || "";
            
            cell.className = 'cell';
            let colorClass = "color-default";
            if (note.includes("ä¾‹å‡") || note.includes("ä¼‘å‡")) { colorClass = "color-holiday"; offCount++; }
            else if (note.includes("ç‰¹ä¼‘")) { colorClass = "color-special"; offCount++; }
            else if (note.includes("ç­")) { workCount++; }

            cell.innerHTML = `<div class="day-num ${d.getDay()===0||d.getDay()===6?'is-weekend':''}">${i}</div><div class="memo-text ${colorClass}">${note}</div>`;
            
            cell.onclick = () => {
                const oldNote = localStorage.getItem('note-' + dateKey) || "";
                if (isClearMode) {
                    if (oldNote.includes("ç‰¹ä¼‘")) totalVacationHr += 12;
                    localStorage.removeItem('note-' + dateKey);
                } else {
                    let f = document.getElementById('factorySelect').value;
                    let t = document.getElementById('typeSelect').value;
                    if (!f && !t) return;
                    let newNote = (f && t) ? f + "\n" + t : (f || t);
                    if (newNote.includes("ç‰¹ä¼‘") && !oldNote.includes("ç‰¹ä¼‘")) totalVacationHr -= 12;
                    if (!newNote.includes("ç‰¹ä¼‘") && oldNote.includes("ç‰¹ä¼‘")) totalVacationHr += 12;
                    localStorage.setItem('note-' + dateKey, newNote);
                }
                saveGlobal();
            };
            grid.appendChild(cell);
        }
        document.getElementById('stat-off').innerText = `æœ¬æœˆå·²ä¼‘ï¼š${offCount} å¤©`;
        document.getElementById('stat-work').innerText = `æœ¬æœˆä¸Šç­ï¼š${workCount * 12} å°æ™‚`;
    }

    function changeMonth(d) { curM += d; if (curM < 0) {curM=11;curY--;} else if (curM>11) {curM=0;curY++;} renderCalendar(); }
    window.onload = renderCalendar;
</script>
</body>
</html>
