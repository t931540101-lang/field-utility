<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K9 è­¦è¡›å®¤ | é›²ç«¯è¨ªå®¢ç™»è¨˜ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 p-4 font-sans">
    <div class="max-w-4xl mx-auto">
        <header class="bg-slate-800 text-white p-4 rounded-t-xl flex justify-between items-center shadow-lg">
            <h1 class="text-xl font-black tracking-widest">ğŸ“‹ é›²ç«¯è¨ªå®¢ç™»è¨˜ç³»çµ±</h1>
            <span class="text-sm bg-slate-700 px-3 py-1 rounded-full">ç¸½æ©Ÿé›»è…¦é€£ç·šä¸­</span>
        </header>

        <div class="bg-white p-6 shadow-md border-x border-slate-200 grid grid-cols-1 md:grid-cols-4 gap-4">
            <input id="vName" type="text" placeholder="è¨ªå®¢å§“å" class="p-3 border-2 border-slate-200 rounded-lg outline-none focus:border-slate-800 transition-all">
            <input id="vCompany" type="text" placeholder="æ‰€å±¬å–®ä½" class="p-3 border-2 border-slate-200 rounded-lg outline-none focus:border-slate-800 transition-all">
            <input id="vReason" type="text" placeholder="å…¥å» äº‹ç”±" class="p-3 border-2 border-slate-200 rounded-lg outline-none focus:border-slate-800 transition-all">
            <button onclick="addVisitor()" class="bg-slate-800 text-white font-bold py-3 rounded-lg hover:bg-slate-700 active:scale-95 transition-all">ç™»è¨˜é€²å…¥</button>
        </div>

        <div class="bg-white shadow-xl rounded-b-xl overflow-hidden mt-4">
            <table class="w-full text-left">
                <thead class="bg-slate-50 border-b border-slate-200 text-slate-500 text-sm">
                    <tr>
                        <th class="p-4">æ™‚é–“</th>
                        <th class="p-4">å§“å</th>
                        <th class="p-4">å–®ä½</th>
                        <th class="p-4">äº‹ç”±</th>
                        <th class="p-4 text-center">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="visitorList" class="divide-y divide-slate-100">
                    </tbody>
            </table>
        </div>

        <div class="mt-4 flex justify-end">
            <button onclick="clearOldData()" class="text-slate-400 text-xs hover:text-red-500 transition-colors">âš ï¸ æ¸…é™¤æ‰€æœ‰è¨ªå®¢è³‡æ–™</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
            databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
            projectId: "factor-security-d1965",
            appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // æ–°å¢è¨ªå®¢
        function addVisitor() {
            const name = document.getElementById('vName').value;
            const company = document.getElementById('vCompany').value;
            const reason = document.getElementById('vReason').value;
            const time = new Date().toLocaleString('zh-TW', { hour12: false });

            if (name && company) {
                db.ref('visitors').push({
                    name, company, reason, time
                });
                document.getElementById('vName').value = '';
                document.getElementById('vCompany').value = '';
                document.getElementById('vReason').value = '';
            } else {
                alert("è«‹è‡³å°‘è¼¸å…¥å§“åèˆ‡å–®ä½ï¼");
            }
        }

        // åˆªé™¤å–®ç­†è³‡æ–™
        function deleteVisitor(id) {
            if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†ç™»è¨˜è³‡æ–™å—ï¼Ÿ")) {
                db.ref(`visitors/${id}`).remove();
            }
        }

        // æ¸…é™¤æ‰€æœ‰è³‡æ–™
        function clearOldData() {
            if(confirm("ç¢ºå®šè¦ã€å…¨éƒ¨æ¸…ç©ºã€‘å—ï¼Ÿé€™å°‡åˆªé™¤ç›®å‰æ¸…å–®ä¸Šæ‰€æœ‰è¨ªå®¢ï¼")) {
                db.ref('visitors').remove();
            }
        }

        // ç›£è½ Firebase æ•¸æ“š
        db.ref('visitors').on('value', (snapshot) => {
            const list = document.getElementById('visitorList');
            list.innerHTML = '';
            const data = snapshot.val();
            
            if (data) {
                Object.keys(data).reverse().forEach(id => {
                    const v = data[id];
                    list.innerHTML += `
                        <tr class="hover:bg-slate-50 transition-colors">
                            <td class="p-4 text-slate-500 text-xs">${v.time}</td>
                            <td class="p-4 font-bold text-slate-800">${v.name}</td>
                            <td class="p-4 text-slate-600">${v.company}</td>
                            <td class="p-4 text-slate-600">${v.reason}</td>
                            <td class="p-4 text-center">
                                <button onclick="deleteVisitor('${id}')" class="text-red-400 hover:text-red-600 p-2 rounded-full hover:bg-red-50 transition-all">
                                    ğŸ—‘ï¸
                                </button>
                            </td>
                        </tr>
                    `;
                });
            } else {
                list.innerHTML = '<tr><td colspan="5" class="p-8 text-center text-slate-400">ç›®å‰å°šç„¡è¨ªå®¢ç™»è¨˜</td></tr>';
            }
        });
    </script>
</body>
</html>
