<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K9 ç‰¹ä¼‘ç­è¡¨ç®¡ç†-è‡ªè¨‚æ’ç­ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #e5e1d3; font-family: sans-serif; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #d1d5db; }
        /* æ ¼å­æ¨£å¼å„ªåŒ– */
        .day-cell { background-color: white; aspect-ratio: 1/1.3; padding: 4px; font-size: 11px; display: flex; flex-direction: column; cursor: pointer; transition: 0.2s; }
        .day-cell:active { background-color: #f0f0f0; }
        .off-day-bg { background-color: #fff1f2; } /* ä¼‘å‡æ™‚çš„æ·¡æ·¡ç´…åº• */
        .off-text { color: #b91c1c; font-weight: bold; } 
        .work-text { color: #065f46; font-weight: bold; }
        .today-border { border: 2px solid #ef4444 !important; }
        .other-month { background-color: #f3f4f6; pointer-events: none; }
    </style>
</head>
<body class="max-w-md mx-auto shadow-lg min-h-screen flex flex-col">

    <div class="bg-black text-white p-3 flex justify-between items-center">
        <div class="flex flex-col">
            <span class="text-[10px] text-gray-400">åŸ·è¡Œè€…ï¼šæŸ”</span>
            <span class="font-bold text-sm">å¤¥ä¼´ï¼šç­é•·å°é»‘å“¥</span>
        </div>
        <div class="text-right">
            <span class="text-[10px] text-gray-400">å‰©é¤˜ç‰¹ä¼‘</span><br>
            <span class="text-yellow-500 font-bold text-xl"><span id="hr-count">48</span><span class="text-xs ml-1">HR</span></span>
        </div>
    </div>

    <div class="bg-[#4a6741] text-white p-2 flex justify-between items-center shadow-md">
        <button onclick="changeMonth(-1)" class="px-4 py-1 active:opacity-50">â—€</button>
        <div class="text-center">
            <span id="current-label" class="font-bold">2026å¹´ 2æœˆ</span>
            <div id="target-msg" class="text-[9px] opacity-80">æœ¬æœˆç›®æ¨™ï¼šä¼‘ 6 å¤© (å°æœˆ)</div>
        </div>
        <button onclick="changeMonth(1)" class="px-4 py-1 active:opacity-50">â–¶</button>
    </div>

    <div class="text-[9px] text-center bg-[#ede9d9] py-1 text-gray-500 font-bold italic">ğŸ’¡ é»æ“Šæ—¥æœŸå¯åˆ‡æ›ã€Œæ—¥Bç­/ä¼‘å‡ã€</div>

    <div class="grid grid-cols-7 bg-[#ede9d9] text-[#9a8c73] text-[10px] text-center py-1 border-b border-gray-300">
        <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
    </div>

    <div class="calendar-grid border-b border-gray-300" id="calendar"></div>

    <div class="p-4 bg-[#ede9d9] flex-grow">
        <div class="grid grid-cols-3 gap-2 mb-4">
            <button onclick="deduct(1)" class="bg-white border border-gray-300 py-3 rounded shadow-sm text-xs font-bold active:bg-gray-200">-1 HR</button>
            <button onclick="deduct(4)" class="bg-white border border-gray-300 py-3 rounded shadow-sm text-xs font-bold active:bg-gray-200">-4 HR</button>
            <button onclick="deduct(8)" class="bg-white border border-gray-300 py-3 rounded shadow-sm text-xs font-bold active:bg-gray-200">-8 HR</button>
        </div>
        
        <div class="flex justify-between items-center border-t border-gray-300 pt-3">
            <button onclick="resetHr()" class="text-[10px] text-gray-400 underline">æ‰‹å‹•æ ¡æ­£æ™‚æ•¸</button>
            <div class="text-[9px] text-gray-400 text-right italic">
                æˆ°å ´æ¸…ç†ï¼šGitHub å°éŠ€æ—¥èªŒå·²åˆªé™¤<br>
                ä¸»æ­¦å™¨ï¼šKingston 240G (50æ©Ÿæ§)
            </div>
        </div>
    </div>

    <script>
        let totalHours = parseFloat(localStorage.getItem('k9_total_hr')) || 48;
        let viewDate = new Date(2026, 1, 1);
        // ç”¨ä¾†å­˜æ”¾è‡ªè¨‚ç­è¡¨ï¼Œæ ¼å¼ï¼š { "2026-2-15": "off", "2026-2-16": "work" }
        let schedule = JSON.parse(localStorage.getItem('k9_schedule')) || {};

        function updateHR() {
            document.getElementById('hr-count').innerText = totalHours;
            localStorage.setItem('k9_total_hr', totalHours);
        }

        function deduct(amt) {
            if(totalHours >= amt) { totalHours -= amt; updateHR(); }
            else { alert("ç­é•·ï¼Œæ™‚æ•¸ä¸å¤ å›‰ï¼"); }
        }

        function resetHr() {
            let n = prompt("è«‹è¼¸å…¥æ ¡æ­£å¾Œçš„ç¸½æ™‚æ•¸ï¼š", totalHours);
            if(n !== null) { totalHours = parseFloat(n) || 0; updateHR(); }
        }

        function toggleDay(key) {
            // åˆ‡æ›ç­è¡¨ç‹€æ…‹
            schedule[key] = (schedule[key] === 'off') ? 'work' : 'off';
            localStorage.setItem('k9_schedule', JSON.stringify(schedule));
            renderCalendar();
        }

        function changeMonth(delta) {
            viewDate.setMonth(viewDate.getMonth() + delta);
            renderCalendar();
        }

        function renderCalendar() {
            const cal = document.getElementById('calendar');
            const year = viewDate.getFullYear();
            const month = viewDate.getMonth();
            cal.innerHTML = '';

            document.getElementById('current-label').innerText = `${year}å¹´ ${month + 1}æœˆ`;
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const isBig = daysInMonth >= 31;
            document.getElementById('target-msg').innerText = `æœ¬æœˆç›®æ¨™ï¼šä¼‘ ${isBig ? 7 : 6} å¤© (${isBig ? 'å¤§æœˆ' : 'å°æœˆ'})`;

            const firstDay = new Date(year, month, 1).getDay();
            const today = new Date();

            for (let i = 0; i < firstDay; i++) {
                cal.innerHTML += `<div class="day-cell other-month"></div>`;
            }

            for (let i = 1; i <= daysInMonth; i++) {
                const dateKey = `${year}-${month + 1}-${i}`;
                const isToday = (year === today.getFullYear() && month === today.getMonth() && i === today.getDate());
                
                // è®€å–è‡ªè¨‚ç­è¡¨ï¼Œé è¨­å…­æ—¥ç‚ºä¼‘å‡é…è‰²
                const dayOfWeek = new Date(year, month, i).getDay();
                const defaultType = (dayOfWeek === 0 || dayOfWeek === 6) ? 'off' : 'work';
                const currentType = schedule[dateKey] || defaultType;

                const isOff = currentType === 'off';
                const cellClass = isOff ? 'off-day-bg' : '';
                const textClass = isOff ? 'off-text' : 'work-text';
                const label = isOff ? 'ä¼‘å‡' : 'æ—¥Bç­';

                cal.innerHTML += `
                    <div class="day-cell ${cellClass} ${isToday ? 'today-border' : ''}" onclick="toggleDay('${dateKey}')">
                        <div class="${textClass}">${i}</div>
                        <div class="text-[8px] text-gray-400 mt-auto">${label}</div>
                    </div>`;
            }
        }

        renderCalendar();
        updateHR();
    </script>
</body>
</html>
