<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>K9 ç¸é†«è­·ç†ç«™ | 2026 å®Œæ•´åŠŸèƒ½ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; color: #1e293b; padding: 15px; }
        .medical-paper { background: white; border: 2px solid #1e293b; box-shadow: 6px 6px 0px #cbd5e1; border-radius: 4px; padding: 15px; margin-bottom: 30px; position: relative; }
        .stamp { border: 2.5px solid #ef4444; color: #ef4444; transform: rotate(-12deg); font-weight: 900; padding: 2px 8px; border-radius: 4px; display: inline-block; font-size: 11px; position: absolute; right: 15px; top: 12px; }
        .grid-table { display: grid; grid-template-columns: 60px 1fr 60px 1fr; border: 2px solid #1e293b; font-size: 13px; }
        .grid-label { background: #1e293b; color: white; padding: 5px; text-align: center; font-weight: bold; border: 0.5px solid #334155; }
        .grid-content { padding: 5px; border: 0.5px solid #1e293b; font-weight: bold; background: white; display: flex; align-items: center; justify-content: center; }
        .log-table { border: 2px solid #1e293b; border-top: none; margin-top: -2px; }
        .log-header { background: #f8fafc; border-bottom: 2px solid #1e293b; display: flex; font-weight: bold; font-size: 11px; }
        .log-row { display: flex; border-bottom: 1px solid #cbd5e1; font-size: 13px; min-height: 45px; }
        .add-btn { background: #1e293b; color: white; width: 100%; padding: 12px; font-weight: 900; font-size: 13px; border-radius: 4px; margin-top: 15px; }
        .edit-btn { position: absolute; right: 15px; bottom: 15px; background: #f1f5f9; padding: 4px 8px; border-radius: 4px; font-size: 12px; border: 1px solid #cbd5e1; color: #64748b; }
    </style>
</head>
<body>

    <header class="flex justify-between items-end border-b-4 border-slate-800 pb-2 mb-8">
        <div>
            <h1 class="text-2xl font-black text-slate-800 leading-tight">å°ç£ç²¾éŠ³çŠ¬éš»<br>è‡¨åºŠç—…æ­·ç³»çµ±</h1>
            <p class="text-[11px] font-bold text-slate-500 mt-1">ğŸ‘©â€âš•ï¸ è­·ç†å¸«ï¼šå°é»‘å“¥ | V7.0 FULL</p>
        </div>
        <div class="stamp">å·²èªè­‰</div>
    </header>

    <div id="k9-list"></div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxm4CDB5i8V2CX6lbCu4gxI2TH-jGKFznI8H01CLlnKEh9Fdr71pfeQr7ai6VcVtAvomw/exec";
        
        // å…«éš»ç‹—ç‹—åå–®èˆ‡åˆå§‹è³‡æ–™
        let dogData = JSON.parse(localStorage.getItem('K9_BASE_INFO')) || [
            { id: 1, name: 'å¼µå¸ƒä¸', sex: 'M', age: '3Y+', weight: '43.5', breed: 'é«˜å±±çŠ¬' },
            { id: 2, name: 'å¦å¦', sex: 'F', age: '?', weight: '?', breed: 'ç±³å…‹æ–¯' },
            { id: 3, name: 'ç‹—ç‹—3', sex: '?', age: '?', weight: '?', breed: '?' },
            { id: 4, name: 'ç‹—ç‹—4', sex: '?', age: '?', weight: '?', breed: '?' },
            { id: 5, name: 'ç‹—ç‹—5', sex: '?', age: '?', weight: '?', breed: '?' },
            { id: 6, name: 'ç‹—ç‹—6', sex: '?', age: '?', weight: '?', breed: '?' },
            { id: 7, name: 'ç‹—ç‹—7', sex: '?', age: '?', weight: '?', breed: '?' },
            { id: 8, name: 'ç‹—ç‹—8', sex: '?', age: '?', weight: '?', breed: '?' }
        ];

        let allLogs = JSON.parse(localStorage.getItem('K9_ALL_LOGS_PRO_FINAL') || '{}');

        function renderDogs() {
            const list = document.getElementById('k9-list');
            list.innerHTML = dogData.map(dog => {
                const logs = allLogs[dog.name] || [];
                return `
                    <div class="medical-paper">
                        <div class="grid-table">
                            <div class="grid-label">å§“å</div><div class="grid-content text-blue-600">${dog.name}</div>
                            <div class="grid-label">é«”é‡</div><div class="grid-content">${dog.weight} KG</div>
                            <div class="grid-label">æ€§åˆ¥</div><div class="grid-content">${dog.sex}/${dog.age}</div>
                            <div class="grid-label">å“ç¨®</div><div class="grid-content text-[10px] leading-tight">${dog.breed}</div>
                        </div>
                        <div class="log-table">
                            <div class="log-header">
                                <div class="w-[30%] p-2 text-center border-r-2 border-slate-800">è¨ºç™‚æ™‚é–“</div>
                                <div class="w-[70%] p-2">è‡¨åºŠç´€éŒ„ (åŒæ­¥é›²ç«¯)</div>
                            </div>
                            <div id="logs-${dog.name}">
                                ${logs.length === 0 ? '<div class="p-6 text-center text-slate-300 italic text-xs">å°šç„¡ç´€éŒ„</div>' : 
                                  logs.map(l => `
                                    <div class="log-row">
                                        <div class="w-[30%] p-2 border-r-2 border-slate-800 text-[9px] text-slate-500 flex items-center justify-center font-mono text-center leading-tight">${l.time}</div>
                                        <div class="w-[70%] p-2 italic flex items-center font-medium">${l.note}</div>
                                    </div>
                                  `).join('')}
                            </div>
                        </div>
                        <button onclick="addLog('${dog.name}', '${dog.weight}')" class="add-btn">
                            + æ–°å¢è‡¨åºŠç´€éŒ„ (SAVE TO CLOUD)
                        </button>
                        <button onclick="editDogInfo(${dog.id})" class="edit-btn">âœï¸ ä¿®æ”¹åŸºæœ¬è³‡æ–™</button>
                    </div>
                `;
            }).join('');
        }

        function editDogInfo(id) {
            const dog = dogData.find(d => d.id === id);
            const nName = prompt("ä¿®æ”¹åå­—:", dog.name);
            const nWeight = prompt("ä¿®æ”¹é«”é‡ (KG):", dog.weight);
            const nSexAge = prompt("ä¿®æ”¹æ€§åˆ¥/å¹´é½¡ (M/3Y+):", dog.sex + "/" + dog.age);
            const nBreed = prompt("ä¿®æ”¹å“ç¨®:", dog.breed);
            
            if (nName) dog.name = nName;
            if (nWeight) dog.weight = nWeight;
            if (nSexAge) {
                const parts = nSexAge.split('/');
                dog.sex = parts[0] || dog.sex;
                dog.age = parts[1] || dog.age;
            }
            if (nBreed) dog.breed = nBreed;
            
            localStorage.setItem('K9_BASE_INFO', JSON.stringify(dogData));
            renderDogs();
        }

        async function addLog(name, weight) {
            const note = prompt(`è­·ç†å¸«å°é»‘å“¥ï¼Œè«‹è¼¸å…¥ [${name}] çš„ç´€éŒ„ï¼š`);
            if (!note) return;
            const now = new Date();
            const timeStr = (now.getMonth()+1) + '/' + now.getDate() + ' ' + now.getHours() + ':' + (now.getMinutes()<10?'0':'') + now.getMinutes();
            if (!allLogs[name]) allLogs[name] = [];
            allLogs[name].unshift({ time: timeStr, note: note });
            localStorage.setItem('K9_ALL_LOGS_PRO_FINAL', JSON.stringify(allLogs));
            renderDogs();
            try {
                const query = `type=k9&dogName=${encodeURIComponent(name)}&area=${encodeURIComponent(weight + " KG")}&health=é†«ç™‚ç´€éŒ„&note=${encodeURIComponent(note)}`;
                fetch(`${SCRIPT_URL}?${query}`, { mode: 'no-cors' });
                alert("âœ… é›²ç«¯åŒæ­¥æˆåŠŸï¼");
            } catch (e) { console.log("Sync error"); }
        }

        renderDogs();
    </script>
</body>
</html>
