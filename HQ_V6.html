<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>M-SECURITY | 戰術終端 V7.1</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --mp-blue: #3273b5;
            --mp-grad: linear-gradient(to bottom, #74b9ff, #3273b5);
            --btn-blue: linear-gradient(to bottom, #74b9ff, #0984e3);
            --alert-red: #ff0000;
        }

        body { margin: 0; background: #b0bec5; font-family: "Microsoft JhengHei", sans-serif; overflow-x: hidden; }

        /* --- 登入畫面 --- */
        #login-page { display: flex; flex-direction: column; align-items: center; height: 100vh; background: #e3f2fd; }
        .login-title { color: #0d47a1; font-style: italic; font-weight: bold; font-size: 28px; margin: 40px 0; }
        .login-box { width: 90%; max-width: 400px; background: white; border: 1px solid #90caf9; padding: 15px; border-radius: 4px; }

        /* --- 主面板 --- */
        #main-terminal { display: none; }
        .alert-bar { background: #000; color: var(--alert-red); padding: 8px; text-align: center; font-size: 13px; font-weight: bold; }
        .header-banner { background: var(--mp-grad); padding: 25px 0; text-align: center; color: white; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .header-banner h1 { margin: 0; font-size: 32px; font-style: italic; font-weight: 900; letter-spacing: 2px; }
        
        .tabs { display: flex; background: #546e7a; }
        .tab { flex: 1; text-align: center; padding: 15px 0; color: white; cursor: pointer; font-weight: bold; border-right: 1px solid #455a64; }
        .tab.active { background: var(--mp-blue); }

        .content { padding: 12px; background: #cfd8dc; }
        .status-row { padding-bottom: 10px; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .status-box { width: 18px; height: 18px; background: var(--mp-blue); border: 1px solid #fff; }

        .search-card { background: #fff; border: 1px solid #999; padding: 15px; }
        input, select { width: 100%; height: 52px; border: 1px solid #ccc; margin-bottom: 10px; padding: 0 12px; font-size: 20px; box-sizing: border-box; }
        .btn-mp { width: 100%; height: 60px; color: white; font-weight: bold; font-size: 22px; background: var(--btn-blue); border: 1px solid #1565c0; border-radius: 4px; cursor: pointer; }
        .btn-row { display: flex; gap: 6px; margin-bottom: 8px; }

        /* 結果顯示 */
        .res-box { margin-top: 15px; padding: 15px; border-radius: 4px; display: none; }
        .res-ok { background: #e8f5e9; border: 2px solid #2e7d32; color: #1b5e20; }
        .res-warn { background: #ffebee; border: 2px solid #c62828; color: #b71c1c; animation: flash 0.5s infinite; }
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        
        /* 單位字體美化 */
        .info-label { font-size: 16px; color: #666; margin-top: 5px; }
        .info-value { font-size: 24px; color: #000; font-weight: bold; }
    </style>
</head>
<body>

    <div id="login-page">
        <div class="login-title">M-Police 整合查詢</div>
        <div class="login-box">
            <input type="text" placeholder="登錄碼">
            <input type="text" placeholder="帳號">
            <select><option>請選擇勤務類別</option><option>門崗勤務</option></select>
            <div class="btn-row">
                <button class="btn-mp" onclick="doLogin()">登入系統</button>
            </div>
        </div>
    </div>

    <div id="main-terminal">
        <div class="alert-bar">[通報] 系統重生完成，目前已恢復雲端同步狀態</div>
        <div class="header-banner"><h1>M-Security 整合查詢</h1></div>
        <div class="tabs">
            <div class="tab active">一般</div><div class="tab">進階</div><div class="tab">其他</div>
        </div>
        <div class="content">
            <div class="status-row">
                <span>查詢模式：</span><div class="status-box"></div><span>線上同步中</span>
            </div>
            <div class="search-card">
                <input type="text" id="qInput" placeholder="請輸入 車號 或 工號">
                <div class="btn-row">
                    <button class="btn-mp" onclick="qSearch()">查 詢</button>
                    <button class="btn-mp" style="background:#4fc3f7">掃 描</button>
                </div>
                <button class="btn-mp" style="background:#607d8b; border:1px solid #455a64;" onclick="location.reload()">清 除</button>
            </div>

            <div id="res" class="res-box">
                <div id="res-info" style="text-align:center;"></div>
            </div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function doLogin() {
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-terminal').style.display = 'block';
    }

    function qSearch() {
        const val = document.getElementById('qInput').value.trim().toUpperCase();
        if(!val) return;
        const resBox = document.getElementById('res');
        const resInfo = document.getElementById('res-info');
        
        resBox.style.display = 'block';
        resInfo.innerHTML = "正在檢索雲端...";

        // 戰術邏輯：先查黑名單
        db.ref('blacklist_data').orderByChild('name').equalTo(val).once('value', s1 => {
            if(s1.exists()){
                resBox.className = "res-box res-warn";
                resInfo.innerHTML = `<div style="font-size:32px;">⚠️ 警戒對象</div><div class="info-value">${val}</div>`;
            } else {
                // 再查員工
                db.ref('employee_list/' + val).once('value', s2 => {
                    if(s2.exists()){
                        const d = s2.val();
                        resBox.className = "res-box res-ok";
                        // --- 升級：顯示姓名與單位 ---
                        resInfo.innerHTML = `
                            <div style="font-size:26px; margin-bottom:10px;">✅ 內部員工</div>
                            <div class="info-label">姓名</div>
                            <div class="info-value">${d.name}</div>
                            <div class="info-label" style="margin-top:10px;">屬性 / 單位</div>
                            <div class="info-value" style="color:#1b5e20;">${d.reason || d.dept || '未註記'}</div>
                        `;
                    } else {
                        resBox.className = "res-box";
                        resBox.style.background = "#eee";
                        resInfo.innerHTML = "查無此紀錄";
                    }
                });
            }
        });
    }
</script>
</body>
</html>
