<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026å¹´02æœˆè­¦è¡›è¼ªç­è¡¨</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --primary: #d32f2f; --bg: #f8f9fa; --border: #ccc; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .lock-btn { padding: 5px 15px; border-radius: 20px; border: none; background: #95a5a6; color: white; cursor: pointer; }
        .lock-btn.unlocked { background: #27ae60; }
        
        /* ç­è¡¨å®¹å™¨ï¼šæ”¯æ´æ‰‹æ©Ÿæ©«å‘æ»‘å‹• */
        .table-container { width: 100%; overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        table { border-collapse: collapse; min-width: 1200px; width: 100%; }
        th, td { border: 1px solid var(--border); padding: 8px 4px; text-align: center; font-size: 13px; }
        th { background: #eee; position: sticky; top: 0; z-index: 10; }
        .sticky-col { position: sticky; left: 0; background: #fdfdfd; z-index: 5; border-right: 2px solid var(--border); }
        
        /* ç­åˆ¥é…è‰² */
        input { width: 100%; border: none; text-align: center; font-size: 12px; background: transparent; pointer-events: none; }
        .can-edit input { pointer-events: auto; background: #fffde7; }
        .cell-holiday { color: #d32f2f; font-weight: bold; } /* ä¾‹å‡ */
        .cell-day { color: #2c3e50; } /* æ—¥ç­ */
        .cell-night { color: #3498db; } /* å¤œç­ */
    </style>
</head>
<body>

<div class="header">
    <h3 style="margin:0;">ğŸ“… 2026å¹´02æœˆ è­¦è¡›è¼ªç­è¡¨</h3>
    <button id="lockBtn" class="lock-btn" onclick="toggleLock()">ğŸ”’ å”¯è®€æ¨¡å¼</button>
</div>

<div class="table-container">
    <table id="rosterTable">
        <thead>
            <tr id="dateHeader">
                <th class="sticky-col" style="width: 80px;">å§“å</th>
                </tr>
        </thead>
        <tbody id="rosterBody">
            </tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI9O7S1YdCWor48",
        authDomain: "factor-security-d1965.firebaseapp.com",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        storageBucket: "factor-security-d1965.firebasestorage.app",
        messagingSenderId: "864846943143",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let isEditing = false;

    // å®šç¾©äººå“¡åå–® (å°æ‡‰ç…§ç‰‡)
    const staff = ["ç›§å®¶æ…¶", "ä½•é´»éš†", "è”¡æ˜“å€«", "é‚±é´»éˆ", "æŸ³æ—­æ´²", "é­æ¦®å¿—"];

    // 1. åˆå§‹åŒ–è¡¨æ ¼çµæ§‹
    const headerRow = document.getElementById('dateHeader');
    const tbody = document.getElementById('rosterBody');

    // ç”¢ç”Ÿ 1-28 è™Ÿæ¨™é¡Œ (2æœˆ)
    for (let d = 1; d <= 28; d++) {
        const th = document.createElement('th');
        th.innerText = d;
        headerRow.appendChild(th);
    }

    // ç”¢ç”Ÿäººå“¡åˆ—
    staff.forEach(name => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class="sticky-col"><b>${name}</b></td>`;
        for (let d = 1; d <= 28; d++) {
            const cellId = `${name}_${d}`;
            tr.innerHTML += `<td><input id="${cellId}" onchange="saveShift('${cellId}', this.value)" placeholder="-"></td>`;
        }
        tbody.appendChild(tr);
    });

    // 2. å¯¦æ™‚åŒæ­¥è³‡æ–™
    db.ref('guardSchedules').on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
            Object.keys(data).forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = data[id];
                    // è‡ªå‹•ä¸Šè‰²é‚è¼¯
                    input.classList.remove('cell-holiday', 'cell-day', 'cell-night');
                    if (data[id].includes('ä¾‹') || data[id].includes('ä¼‘')) input.classList.add('cell-holiday');
                    if (data[id].includes('æ—¥')) input.classList.add('cell-day');
                    if (data[id].includes('å¤œ')) input.classList.add('cell-night');
                }
            });
        }
    });

    // 3. å„²å­˜èˆ‡æ¬Šé™åŠŸèƒ½
    function saveShift(id, val) {
        db.ref('guardSchedules/' + id).set(val);
    }

    function toggleLock() {
        if (!isEditing) {
            const pwd = prompt("è«‹è¼¸å…¥äººäº‹ç®¡ç†å¯†ç¢¼ï¼š");
            if (pwd === "8888") {
                isEditing = true;
                document.body.classList.add('can-edit');
                document.getElementById('lockBtn').innerText = "ğŸ”“ ç·¨è¼¯æ¨¡å¼";
                document.getElementById('lockBtn').classList.add('unlocked');
            } else { alert("å¯†ç¢¼éŒ¯èª¤ï¼"); }
        } else {
            isEditing = false;
            document.body.classList.remove('can-edit');
            document.getElementById('lockBtn').innerText = "ğŸ”’ å”¯è®€æ¨¡å¼";
            document.getElementById('lockBtn').classList.remove('unlocked');
        }
    }
// åœ¨ç¸½ç­è¡¨çš„æ¸²æŸ“é‚è¼¯ä¸­ï¼ŒåŠ å…¥é€™æ®µç›£è½
db.ref('guard_requests').on('value', (snapshot) => {
    const requests = snapshot.val();
    if (requests) {
        // éæ­·æ‰€æœ‰äººäº‹è³‡æ–™
        Object.keys(requests).forEach(guardName => {
            Object.keys(requests[guardName]).forEach(date => {
                const status = requests[guardName][date];
                // æ‰¾åˆ°ç¸½ç­è¡¨ä¸Šå°æ‡‰çš„æ ¼å­ (ä¾‹å¦‚: id="ç›§å®¶æ…¶_18")
                const cellId = `${guardName}_${date}`;
                const input = document.getElementById(cellId);
                if (input) {
                    input.value = status; // è‡ªå‹•é¡¯ç¤º âŒ æˆ– ç­åˆ¥
                    if(status === 'âŒ') input.style.color = 'red';
                }
            });
        });
    }
});



