ã€‚<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å‹¤å‹™äº¤æ¥ç°¿ - é›²ç«¯ç‰ˆ</title>
    <style>
        /* ä¿æŒåŸæœ‰çš„ç°¡æ½”çª„è¢å¹•å„ªåŒ– CSS */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f4f5f7; color: #333; margin: 0; padding: 15px; }
        .container { width: 100%; background: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); box-sizing: border-box; }
        h2 { text-align: center; color: #2c3e50; margin-top: 0; margin-bottom: 20px; font-size: 22px; }
        label { display: block; margin-top: 15px; font-weight: 600; font-size: 15px; color: #555; }
        input[type="date"], select, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ccd0d5; border-radius: 6px; box-sizing: border-box; font-size: 16px; background-color: #fafafa; }
        input[type="date"]:focus, select:focus, textarea:focus { border-color: #3498db; outline: none; background-color: #fff; }
        textarea { resize: vertical; height: 120px; }
        .btn-group { display: flex; gap: 12px; margin-top: 25px; }
        button { flex: 1; padding: 14px; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; color: #fff; transition: background-color 0.2s; }
        .btn-save { background-color: #2980b9; }
        .btn-save:active { background-color: #2471a3; }
        .btn-clear { background-color: #e74c3c; }
        .status-msg { margin-top: 15px; text-align: center; font-size: 14px; color: #27ae60; font-weight: bold; min-height: 20px; }
    </style>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
</head>
<body>

<div class="container">
    <h2>å‹¤å‹™äº¤æ¥ç°¿ (é›²ç«¯é€£ç·š)</h2>
    
    <label for="dutyDate">æ—¥æœŸ</label>
    <input type="date" id="dutyDate">

    <label for="shift">ç­åˆ¥</label>
    <select id="shift">
        <option value="day">æ—©ç­ (07:00 - 19:00)</option>
        <option value="night">æ™šç­ (19:00 - 07:00)</option>
    </select>

    <label for="handoverNotes">é‡é»äº¤æ¥äº‹é …èˆ‡ç•°å¸¸ç´€éŒ„</label>
    <textarea id="handoverNotes" placeholder="è«‹è¼¸å…¥éœ€äº¤æ¥çš„å» å€ç‹€æ³ã€äººå“¡é€²å‡ºç•°å¸¸æˆ–äº¤ä»£äº‹é …..."></textarea>

    <label for="equipmentStatus">è£å‚™èˆ‡ç’°å¢ƒé»äº¤</label>
    <textarea id="equipmentStatus" placeholder="ç„¡ç·šé›»ã€é‘°åŒ™æ•¸é‡ã€å·¡é‚è¨­å‚™ç‹€æ…‹..."></textarea>

    <div class="btn-group">
        <button class="btn-save" onclick="saveToCloud()">ä¸Šå‚³é›²ç«¯äº¤æ¥</button>
        <button class="btn-clear" onclick="clearData()">æ¸…é™¤</button>
    </div>
    <div id="statusMessage" class="status-msg"></div>
</div>

<script>
    // 1. åˆå§‹åŒ– Firebase (é€™è£¡éœ€è¦å¡«å…¥å°ˆå±¬è¨­å®š)
        // 1. åˆå§‹åŒ– Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyB2_tKKsVT4kdW7PPkJgI907S1YdCWor48",
        authDomain: "factor-security-d1965.firebaseapp.com",
        databaseURL: "https://factor-security-d1965-default-rtdb.firebaseio.com",
        projectId: "factor-security-d1965",
        storageBucket: "factor-security-d1965.firebasestorage.app",
        messagingSenderId: "864846943143",
        appId: "1:864846943143:web:4cfa18cd20d2f712225c82"
    };

    
    // æª¢æŸ¥æ˜¯å¦å·²å¡«å¯«è¨­å®šï¼Œé¿å…æœªè¨­å®šæ™‚å ±éŒ¯
    if (firebaseConfig.apiKey !== "è«‹å¡«å¯«_API_KEY") {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database ? firebase.database() : null;

    const dutyDate = document.getElementById('dutyDate');
    const shift = document.getElementById('shift');
    const handoverNotes = document.getElementById('handoverNotes');
    const equipmentStatus = document.getElementById('equipmentStatus');
    const statusMessage = document.getElementById('statusMessage');

        // é é¢è¼‰å…¥æ™‚ï¼šè¨­å®šä»Šå¤©æ—¥æœŸï¼Œä¸¦è‡ªå‹•å»é›²ç«¯æŠ“æœ€æ–°ç´€éŒ„
    window.onload = function() {
        const today = new Date().toISOString().split('T')[0];
        dutyDate.value = today;
        
        // å‘¼å«è®€å–é›²ç«¯è³‡æ–™çš„å‡½æ•¸
        loadLatestRecord();
    };

    // 3. å¾ Firebase è®€å–æœ€æ–°ä¸€ç­†äº¤æ¥ç´€éŒ„
    function loadLatestRecord() {
        if (!db) return;
        
        showStatus('ğŸ”„ æ­£åœ¨è®€å–ä¸Šä¸€ç­äº¤æ¥ç´€éŒ„...');
        
        // é‡å° dutyLogs è³‡æ–™å¤¾ï¼Œä¾ç…§ timestamp æ’åºï¼Œä¸¦åªæŠ“å–æœ€å¾Œï¼ˆæœ€æ–°ï¼‰çš„ä¸€ç­†
        db.ref('dutyLogs').orderByChild('timestamp').limitToLast(1).once('value')
            .then((snapshot) => {
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        const data = childSnapshot.val();
                        
                        // å°‡é›²ç«¯æŠ“åˆ°çš„è³‡æ–™ï¼Œè‡ªå‹•å¡«å…¥ç•«é¢çš„æ ¼å­è£¡
                        // å¦‚æœæœ‰è·¨æ—¥äº¤æ¥çš„éœ€æ±‚ï¼Œæ—¥æœŸä¹Ÿå¯ä»¥æ”¹æˆ data.date
                        shift.value = data.shift || 'day';
                        handoverNotes.value = data.notes || '';
                        equipmentStatus.value = data.equipment || '';
                        
                        showStatus('âœ… å·²è‡ªå‹•è¼‰å…¥ä¸Šä¸€ç­æœ€æ–°ç´€éŒ„ï¼');
                    });
                } else {
                    showStatus('ğŸ“ é›²ç«¯ç›®å‰ç„¡ç´€éŒ„ï¼Œè«‹é–‹å§‹å¡«å¯«ã€‚');
                }
            })
            .catch((error) => {
                console.error("è®€å–å¤±æ•—: ", error);
                showStatus('âŒ è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
            });
    }

    // 2. å°‡è³‡æ–™ä¸Šå‚³åˆ° Firebase å³æ™‚è³‡æ–™åº« (ä¿ç•™åŸæœ¬çš„é€™æ®µä¸è¦å‹•)
    function saveToCloud() {
// ... (ä¸‹æ–¹ä¿ç•™ä½ åŸæœ¬å¯«å¥½çš„ saveToCloud èˆ‡ clearData ç¨‹å¼ç¢¼) ...


    // 2. å°‡è³‡æ–™ä¸Šå‚³åˆ° Firebase å³æ™‚è³‡æ–™åº«
    function saveToCloud() {
        if (!db) {
            showStatus('âš ï¸ è«‹å…ˆå®Œæˆ Firebase è¨­å®šé‡‘é‘°');
            return;
        }

        const logData = {
            date: dutyDate.value,
            shift: shift.value,
            notes: handoverNotes.value,
            equipment: equipmentStatus.value,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        };

        // å¯«å…¥è³‡æ–™åº«è·¯å¾‘ï¼š dutyLogs/æ—¥æœŸ_ç­åˆ¥ (ç¢ºä¿æ¯ç­ç´€éŒ„ç¨ç«‹å­˜æ”¾)
        const recordId = dutyDate.value + "_" + shift.value;
        
        db.ref('dutyLogs/' + recordId).set(logData)
            .then(() => {
                showStatus('â˜ï¸ âœ… äº¤æ¥ç´€éŒ„å·²æˆåŠŸä¸Šå‚³é›²ç«¯ï¼');
            })
            .catch((error) => {
                console.error("ä¸Šå‚³å¤±æ•—: ", error);
                showStatus('âŒ ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
            });
    }

    function clearData() {
        if(confirm('ç¢ºå®šè¦æ¸…é™¤ç›®å‰å¡«å¯«çš„æ‰€æœ‰å…§å®¹å—ï¼Ÿ')) {
            handoverNotes.value = '';
            equipmentStatus.value = '';
            showStatus('ğŸ—‘ï¸ æ¬„ä½å·²æ¸…é™¤');
        }
    }

    function showStatus(msg) {
        statusMessage.innerText = msg;
        setTimeout(() => { statusMessage.innerText = ''; }, 3000);
    }
</script>

</body>
</html>
